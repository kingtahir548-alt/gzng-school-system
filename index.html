<!DOCTYPE html>
<html lang="ku" dir="rtl">
<head>
Â  Â  <meta charset="UTF-8">
Â  Â  <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
Â  Â  <title>Ø³ÛŒØ³ØªÛ•Ù…ÛŒ Ú†Ø§Ù„Ø§Ú©ÛŒÛ•Ú©Ø§Ù†ÛŒ Ù‚ÙˆØªØ§Ø¨Ø®Ø§Ù†Û•ÛŒ Ú¯Ø²Ù†Ú¯ - Firebase Edition</title>
Â  Â  <script src="https://cdn.tailwindcss.com"></script>
Â  Â  <script src="https://cdnjs.cloudflare.com/ajax/libs/html2canvas/1.4.1/html2canvas.min.js"></script>
Â  Â  <link href="https://fonts.googleapis.com/css2?family=Noto+Sans+Arabic:wght@300;400;700;900&display=swap" rel="stylesheet">

Â  Â  Â  Â  <script src="https://www.gstatic.com/firebasejs/8.10.1/firebase-app.js"></script>
Â  Â  <script src="https://www.gstatic.com/firebasejs/8.10.1/firebase-firestore.js"></script>
Â  Â  <script src="https://www.gstatic.com/firebasejs/8.10.1/firebase-auth.js"></script>
Â  Â  Â  Â  <style>
Â  Â  Â  Â  body {Â 
Â  Â  Â  Â  Â  Â  font-family: 'Noto Sans Arabic', sans-serif;Â 
Â  Â  Â  Â  Â  Â  background-color: #f3f4f6;Â 
Â  Â  Â  Â  Â  Â  transition: background-color 0.5s ease, color 0.5s ease;
Â  Â  Â  Â  Â  Â  -webkit-tap-highlight-color: transparent;Â 
Â  Â  Â  Â  }

Â  Â  Â  Â  /* ============================
Â  Â  Â  Â  Â  Â TEACHER DARK MODE (Ú©Û†Ø¯ÛŒ CSS ÛŒÛ•Ú©Û•ÛŒ Ù¾ÛØ´ÙˆÙˆ)
Â  Â  Â  Â  Â  Â ============================ */
Â  Â  Â  Â  body.dark-mode { background-color: #0f172a; color: #f1f5f9; }
Â  Â  Â  Â  .dark-mode .input-field { background-color: #1e293b; border-color: #334155; color: white; }
Â  Â  Â  Â  .dark-mode .input-field:focus { border-color: #38bdf8; box-shadow: 0 0 15px rgba(56, 189, 248, 0.2); }
Â  Â  Â  Â  .dark-mode .input-field::placeholder { color: #94a3b8; }
Â  Â  Â  Â  .dark-mode h3, .dark-mode h4, .dark-mode label { color: #e2e8f0 !important; }
Â  Â  Â  Â  .dark-mode .bg-white { background-color: #1e293b !important; border-color: #334155 !important; }
Â  Â  Â  Â  .dark-mode .text-gray-800 { color: #f1f5f9 !important; }
Â  Â  Â  Â  .dark-mode .text-gray-600 { color: #cbd5e1 !important; }
Â  Â  Â  Â  .dark-mode .text-gray-500 { color: #94a3b8 !important; }
Â  Â  Â  Â  .dark-mode .school-header { background: linear-gradient(135deg, rgba(15, 23, 42, 0.95) 0%, rgba(30, 41, 59, 0.95) 100%), url('school.jpg'); border-bottom: 1px solid #334155; }
Â  Â  Â  Â  .dark-mode .btn-white { background-color: #1e293b; color: #cbd5e1; border: 1px solid #334155; }
Â  Â  Â  Â  .dark-mode .btn-white:hover { background-color: #334155 !important; color: #38bdf8 !important; border-color: #38bdf8; }
Â  Â  Â  Â  .dark-mode .btn-white.active { background-color: #3b82f6 !important; color: white !important; border-color: #3b82f6; box-shadow: 0 0 15px rgba(59, 130, 246, 0.4); }

Â  Â  Â  Â  /* ============================
Â  Â  Â  Â  Â  Â ADMIN SPECIAL THEME (Fixed Dark Neon)
Â  Â  Â  Â  Â  Â ============================ */
Â  Â  Â  Â  body.admin-mode { background-color: #020617; color: #f1f5f9; }
Â  Â  Â  Â  .admin-mode .input-field { background-color: #1e293b; border-color: #334155; color: white; }
Â  Â  Â  Â  .admin-mode .input-field:focus { border-color: #8b5cf6; box-shadow: 0 0 15px rgba(139, 92, 246, 0.3); }
Â  Â  Â  Â  .admin-card { background: rgba(30, 41, 59, 0.7); backdrop-filter: blur(10px); border: 1px solid rgba(148, 163, 184, 0.1); box-shadow: 0 4px 6px -1px rgba(0, 0, 0, 0.3); }
Â  Â  Â  Â  .admin-mode .school-header { background: linear-gradient(135deg, rgba(2, 6, 23, 0.98) 0%, rgba(15, 23, 42, 0.98) 100%), url('school.jpg'); border-bottom: 1px solid #1e293b; }
Â  Â  Â  Â  .admin-mode .btn-white { background-color: #1e293b; color: #cbd5e1; border: 1px solid #334155; }
Â  Â  Â  Â  .admin-mode .btn-white:hover { background-color: #334155 !important; color: #c084fc !important; border-color: #c084fc; }
Â  Â  Â  Â  .admin-mode .btn-white.active { background-color: #7c3aed !important; color: white !important; border-color: #7c3aed; box-shadow: 0 0 15px rgba(124, 58, 237, 0.4); }

Â  Â  Â  Â  /* ============================
Â  Â  Â  Â  Â  Â COMMON STYLES (Ú©Û†Ø¯ÛŒ CSS ÛŒÛ•Ú©Û•ÛŒ Ù¾ÛØ´ÙˆÙˆ)
Â  Â  Â  Â  Â  Â ============================ */
Â  Â  Â  Â  .school-header { background: linear-gradient(135deg, rgba(14, 165, 233, 0.98) 0%, rgba(30, 58, 138, 0.98) 100%), url('school.jpg'); background-size: cover; background-position: center; border-bottom-left-radius: 1.5rem; border-bottom-right-radius: 1.5rem; box-shadow: 0 4px 20px rgba(30, 58, 138, 0.4); position: sticky; top: 0; z-index: 40; backdrop-filter: blur(5px); transition: all 0.5s ease; }
Â  Â  Â  Â  @media (min-width: 768px) { .school-header { border-bottom-left-radius: 2.5rem; border-bottom-right-radius: 2.5rem; padding-bottom: 2rem; } }

Â  Â  Â  Â  .input-field { transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1); border: 1px solid #e5e7eb; }
Â  Â  Â  Â  .input-field:focus { transform: translateY(-2px); border-color: #3b82f6; box-shadow: 0 4px 12px rgba(59, 130, 246, 0.15); outline: none; }
Â  Â  Â  Â  .input-error { border-color: #ef4444 !important; background-color: #fef2f2 !important; animation: shake 0.5s cubic-bezier(.36,.07,.19,.97) both; }
Â  Â  Â  Â  .btn-neon { background: linear-gradient(90deg, #3b82f6, #8b5cf6); color: white; transition: all 0.3s ease; position: relative; overflow: hidden; border: none; }
Â  Â  Â  Â  .btn-neon:hover { box-shadow: 0 0 20px rgba(139, 92, 246, 0.5); transform: translateY(-2px); }

Â  Â  Â  Â  .btn-white { background-color: white; color: #4b5563; transition: all 0.2s ease; }
Â  Â  Â  Â  .btn-white:hover { background-color: #dbeafe !important; color: #1d4ed8 !important; transform: translateY(-2px); box-shadow: 0 4px 6px rgba(0,0,0,0.1); }
Â  Â  Â  Â  .btn-white:active { transform: scale(0.95); }
Â  Â  Â  Â  .btn-white.active { background-color: #2563eb !important; color: white !important; box-shadow: 0 4px 12px rgba(37, 99, 235, 0.3); }

Â  Â  Â  Â  .btn-blue { background: linear-gradient(to left, #2563eb, #1d4ed8); color: white; transition: all 0.2s ease; }
Â  Â  Â  Â  .btn-blue:hover { background: linear-gradient(to left, #1e40af, #1e3a8a) !important; transform: translateY(-2px); box-shadow: 0 10px 15px -3px rgba(37, 99, 235, 0.4); }
Â  Â  Â  Â  .btn-blue:active { transform: scale(0.95); }

Â  Â  Â  Â  /* Report Styles (Always Light) */
Â  Â  Â  Â  .report-wrapper { width: 100%; display: flex; justify-content: center; align-items: flex-start; overflow: hidden; padding-top: 20px; }
Â  Â  Â  Â  .a4-page { width: 210mm; min-height: 297mm; background: white !important; padding: 15mm; box-shadow: 0 4px 20px rgba(0,0,0,0.15); direction: rtl; text-align: right; position: relative; transform-origin: top center; color: #1f2937 !important; }
Â  Â  Â  Â  .a4-page * { color: #1f2937 !important; border-color: #e5e7eb; }
Â  Â  Â  Â  .a4-page .bg-white { background-color: white !important; }
Â  Â  Â  Â  .a4-page input { background-color: transparent !important; color: #1f2937 !important; }
Â  Â  Â  Â  .a4-page .report-table th { background-color: #f1f5f9 !important; color: #334155 !important; }
Â  Â  Â  Â  .a4-page .report-table tr:nth-child(even) { background-color: #f8fafc !important; }

Â  Â  Â  Â  .image-slot { background-color: #f8fafc; border: 2px dashed #cbd5e1; position: relative; overflow: hidden; display: flex; align-items: center; justify-content: center; touch-action: none; user-select: none; }
Â  Â  Â  Â  .ar-landscape { aspect-ratio: 16/9; }
Â  Â  Â  Â  .ar-portrait { aspect-ratio: 3/4; }
Â  Â  Â  Â  .img-controls { position: absolute; bottom: 0; left: 0; right: 0; background: rgba(0,0,0,0.7); padding: 4px; display: none; flex-direction: column; gap: 4px; z-index: 10; }
Â  Â  Â  Â  .image-slot:hover .img-controls { display: flex; }
Â  Â  Â  Â Â 
Â  Â  Â  Â  .report-table { width: 100%; border-collapse: collapse; margin-top: 20px; }
Â  Â  Â  Â  .report-table th, .report-table td { border: 1px solid #e2e8f0; padding: 8px; text-align: right; font-size: 14px; }
Â  Â  Â  Â  .report-table th { background-color: #f1f5f9; color: #334155; font-weight: bold; }
Â  Â  Â  Â  .report-table tr:nth-child(even) { background-color: #f8fafc; }
Â  Â  Â  Â Â 
Â  Â  Â  Â  .no-scrollbar::-webkit-scrollbar { display: none; }
Â  Â  Â  Â  .no-scrollbar { -ms-overflow-style: none; scrollbar-width: none; }
Â  Â  Â  Â  ::-webkit-scrollbar { width: 8px; height: 8px; }
Â  Â  Â  Â  ::-webkit-scrollbar-track { background: #f1f1f1; }
Â  Â  Â  Â  ::-webkit-scrollbar-thumb { background: #c1c1c1; border-radius: 4px; }
Â  Â  Â  Â  ::-webkit-scrollbar-thumb:hover { background: #a8a8a8; }
Â  Â  Â  Â  @keyframes shake { 10%, 90% { transform: translate3d(-1px, 0, 0); } 20%, 80% { transform: translate3d(2px, 0, 0); } 30%, 50%, 70% { transform: translate3d(-4px, 0, 0); } 40%, 60% { transform: translate3d(4px, 0, 0); } }

Â  Â  Â  Â  @media print {Â 
Â  Â  Â  Â  Â  Â  body * { visibility: hidden; }Â 
Â  Â  Â  Â  Â  Â  #reportModal, #reportModal * { visibility: visible; }Â 
Â  Â  Â  Â  Â  Â  #reportModal { position: absolute; left: 0; top: 0; width: 100%; height: 100%; background: white; z-index: 9999; padding: 0; overflow: visible; }Â 
Â  Â  Â  Â  Â  Â  .report-wrapper { display: block; padding: 0; width: 100%; height: 100%; transform: none !important; }
Â  Â  Â  Â  Â  Â  .a4-page { margin: 0; box-shadow: none; transform: none !important; width: 210mm; height: 297mm; }Â 
Â  Â  Â  Â  Â  Â  .no-print { display: none !important; }Â 
Â  Â  Â  Â  }
Â  Â  </style>
</head>
<body class="min-h-screen pb-10 relative text-gray-800 bg-gray-50 overflow-y-auto" onmouseup="stopDrag()" onmouseleave="stopDrag()" ontouchend="stopDrag()">
Â  Â Â 
Â  Â  <div id="app" class="w-full"></div>
Â  Â Â 
Â  Â  <div id="statusBar" class="fixed top-4 right-4 z-50 px-3 py-1 rounded-full text-xs font-bold bg-gray-200 text-gray-600 shadow-md hidden transition-all duration-300"></div>
Â  Â  <div id="loadingOverlay" class="hidden fixed inset-0 bg-white/95 z-[9999] flex flex-col items-center justify-center">
Â  Â  Â  Â  <div class="animate-spin rounded-full h-12 w-12 border-4 border-blue-600 border-t-transparent mb-4"></div>
Â  Â  Â  Â  <p id="loadingText" class="text-gray-700 font-bold">Ù¾Û•ÛŒÙˆÛ•Ø³Øª Ø¯Û•Ø¨ÛØª...</p>
Â  Â  </div>
Â  Â  <div id="notification" class="hidden fixed top-5 left-1/2 transform -translate-x-1/2 bg-white/90 backdrop-blur-md px-6 py-4 rounded-2xl shadow-xl z-[1000] text-center border border-green-100 flex items-center gap-3 min-w-[300px]">
Â  Â  Â  Â  <div class="w-10 h-10 bg-green-100 rounded-full flex items-center justify-center flex-shrink-0"><svg class="w-6 h-6 text-green-600" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M5 13l4 4L19 7"></path></svg></div>
Â  Â  Â  Â  <div class="text-right"><h3 class="font-bold text-gray-800" id="notifTitle">ØªÛ†Ù…Ø§Ø±Ú©Ø±Ø§!</h3><p id="notifText" class="text-sm text-gray-500">Ø¨Û• Ø³Û•Ø±Ú©Û•ÙˆØªÙˆÙˆÛŒÛŒ Ù†ÛØ±Ø¯Ø±Ø§.</p></div>
Â  Â  </div>

Â  Â  <script>
Â  Â  Â  Â  const LOGO_BASE64 = "";Â 
Â  Â  Â  Â  const LOGO_URL = LOGO_BASE64.length > 50 ? LOGO_BASE64 : 'logo.png';
Â  Â  Â  Â  const STORAGE_KEY = 'gzng-final-v30-lesson-fix';

Â  Â  Â  Â  // ===========================================
Â  Â  Â  Â  // [START 2] Ø±ÛÚ©Ø®Ø³ØªÙ†Û•Ú©Ø§Ù†ÛŒ Firebase - Ú¯Ø±Ù†Ú¯Û• Ø¨ÛŒ Ú¯Û†Ú•ÛŒØª
Â  Â  Â  Â  // ===========================================
Â  Â  Â  Â  const firebaseConfig = {
Â  Â  Â  Â  Â  // ******************************************************
Â  Â  Â  Â  Â  // âš ï¸ ØªÚ©Ø§ÛŒÛ• Ø¦Û•Ù… ÙˆØ±Ø¯Û•Ú©Ø§Ø±ÛŒÛŒØ§Ù†Û• Ø¨Û• ÙˆØ±Ø¯ÛŒ Ù„Û• Ú©Û†Ù†Ø³ÚµÛŒ Firebase ÙˆÛ•Ø±Ø¨Ú¯Ø±Û• Ùˆ Ø¯Ø§ÛŒØ¨Ù†Û
Â  Â  Â  Â  Â  // ******************************************************
Â  Â  Â  Â  Â  apiKey: "YOUR_API_KEY_GOES_HERE",
Â  Â  Â  Â  Â  authDomain: "your-project-id.firebaseapp.com",
Â  Â  Â  Â  Â  projectId: "your-project-id",
Â  Â  Â  Â  Â  storageBucket: "your-project-id.appspot.com",
Â  Â  Â  Â  Â  messagingSenderId: "SENDER_ID",
Â  Â  Â  Â  Â  appId: "APP_ID"
Â  Â  Â  Â  };

Â  Â  Â  Â  // Ø²ÛŒØ§Ø¯Ú©Ø±Ø¯Ù†ÛŒ Ø¯Ø§ØªØ§Ø¨Û•ÛŒØ³ Ùˆ Ú©Û†Ù„ÛÚ©Ø´Ù†
Â  Â  Â  Â  const app = firebase.initializeApp(firebaseConfig);
Â  Â  Â  Â  const db = firebase.firestore();
Â  Â  Â  Â  const ACTIVITIES_COLLECTION = "activities"; 

Â  Â  Â  Â  // ===========================================
Â  Â  Â  Â  // Ø±ÛÚ©Ø®Ø³ØªÙ†ÛŒ Ù¾Ø§Ø±ÛØ²Ú¯Ø§Ø±ÛŒ - Ø¦Û•Ù…Û•Ø´ Ø¨Ú¯Û†Ú•Û•
Â  Â  Â  Â  // ===========================================
Â  Â  Â  Â  const ALLOWED_ADMIN_EMAIL = "admin@your-school.com"; // Ø¦ÛŒÙ…Û•ÛŒÚµÛŒ Ø¦Û•Ø¯Ù…ÛŒÙ†
Â  Â  Â  Â  const TEACHER_DOMAIN = "your-school.edu"; // Domain Ø¨Û† Ù‡Û•Ù…ÙˆÙˆ Ù…Ø§Ù…Û†Ø³ØªØ§Ú©Ø§Ù† (Ø¦Û•Ú¯Û•Ø± Ù‡Û•Ø¨ÛØª)

Â  Â  Â  Â  // [END 2] Ø±ÛÚ©Ø®Ø³ØªÙ†Û•Ú©Ø§Ù†ÛŒ Firebase

Â  Â  Â  Â  let state = {
Â  Â  Â  Â  Â  Â  currentView: 'teacher', activities: [], isAdminAuthenticated: false, adminPassword: '',Â 
Â  Â  Â  Â  Â  Â  showMonthModal: false, showReportModal: false, showSchedule: false, reportScale: 1,Â 
Â  Â  Â  Â  Â  Â  viewDay: 'Ø´Û•Ù…Ù…Û•', isOnline: true, filterDate: new Date().toISOString().slice(0, 7),Â 
Â  Â  Â  Â  Â  Â  login: { username: '', password: '' },
Â  Â  Â  Â  Â  Â  theme: localStorage.getItem('gzng-theme') || 'light',Â 
Â  Â  Â  Â  Â  Â  form: { teacherName: '', subject: '', activityName: '', dayOfWeek: '', lessonNumber: '', date: new Date().toISOString().split('T')[0] },
Â  Â  Â  Â  Â  Â  report: { teacherName: '', activityName: '', date: new Date().toISOString().split('T')[0], orientation: 'landscape', showTeacher: true, images: [null, null, null, null], imgSettings: Array(4).fill().map(() => ({zoom: 1, x: 50, y: 50})) }
Â  Â  Â  Â  };

Â  Â  Â  Â  function getLessonName(activity) {
Â  Â  Â  Â  Â  Â  let val = activity.lessonNumber || activity.lessonTime;
Â  Â  Â  Â  Â  Â  if (!val || val === 'undefined') return 'Ø¯ÛŒØ§Ø±ÛŒ Ù†Û•Ú©Ø±Ø§ÙˆÛ•';
Â  Â  Â  Â  Â  Â  const map = { '1': 'ÙˆØ§Ù†Û•ÛŒ ÛŒÛ•Ú©Û•Ù…', '2': 'ÙˆØ§Ù†Û•ÛŒ Ø¯ÙˆÙˆÛ•Ù…', '3': 'ÙˆØ§Ù†Û•ÛŒ Ø³ÛÛŒÛ•Ù…', '4': 'ÙˆØ§Ù†Û•ÛŒ Ú†ÙˆØ§Ø±Û•Ù…', '5': 'ÙˆØ§Ù†Û•ÛŒ Ù¾ÛÙ†Ø¬Û•Ù…', '6': 'ÙˆØ§Ù†Û•ÛŒ Ø´Û•Ø´Û•Ù…' };
Â  Â  Â  Â  Â  Â  return map[val] || val;
Â  Â  Â  Â  }

Â  Â  Â  Â  function toggleTheme() {
Â  Â  Â  Â  Â  Â  state.theme = state.theme === 'light' ? 'dark' : 'light';
Â  Â  Â  Â  Â  Â  localStorage.setItem('gzng-theme', state.theme);
Â  Â  Â  Â  Â  Â  render();
Â  Â  Â  Â  }

Â  Â  Â  Â  let drag = { active: false, idx: -1, startX: 0, startY: 0, initialX: 50, initialY: 50 };
Â  Â  Â  Â  let rafId = null;

Â  Â  Â  Â  function startDrag(e, idx) {Â 
Â  Â  Â  Â  Â  Â  if (!state.report.images[idx] || ['INPUT', 'BUTTON', 'RANGE'].includes(e.target.tagName)) return;Â 
Â  Â  Â  Â  Â  Â  if (e.type === 'touchstart' && e.touches.length > 1) return;
Â  Â  Â  Â  Â  Â  e.preventDefault(); drag.active = true; drag.idx = idx;Â 
Â  Â  Â  Â  Â  Â  const pt = e.touches ? e.touches[0] : e;
Â  Â  Â  Â  Â  Â  drag.startX = pt.clientX; drag.startY = pt.clientY;Â 
Â  Â  Â  Â  Â  Â  drag.initialX = parseFloat(state.report.imgSettings[idx].x);Â 
Â  Â  Â  Â  Â  Â  drag.initialY = parseFloat(state.report.imgSettings[idx].y);Â 
Â  Â  Â  Â  }

Â  Â  Â  Â  function onMove(e) {Â 
Â  Â  Â  Â  Â  Â  if (!drag.active) return;Â 
Â  Â  Â  Â  Â  Â  e.preventDefault();Â 
Â  Â  Â  Â  Â  Â  if (rafId) cancelAnimationFrame(rafId);
Â  Â  Â  Â  Â  Â  rafId = requestAnimationFrame(() => {
Â  Â  Â  Â  Â  Â  Â  Â  const pt = e.touches ? e.touches[0] : e;
Â  Â  Â  Â  Â  Â  Â  Â  const sensitivity = 0.4 / state.reportScale;Â 
Â  Â  Â  Â  Â  Â  Â  Â  const dX = (drag.startX - pt.clientX) * sensitivity;Â 
Â  Â  Â  Â  Â  Â  Â  Â  const dY = (drag.startY - pt.clientY) * sensitivity;Â 
Â  Â  Â  Â  Â  Â  Â  Â  let nX = Math.min(100, Math.max(0, drag.initialX + dX));Â 
Â  Â  Â  Â  Â  Â  Â  Â  let nY = Math.min(100, Math.max(0, drag.initialY + dY));Â 
Â  Â  Â  Â  Â  Â  Â  Â  state.report.imgSettings[drag.idx].x = nX;Â 
Â  Â  Â  Â  Â  Â  Â  Â  state.report.imgSettings[drag.idx].y = nY;Â 
Â  Â  Â  Â  Â  Â  Â  Â  const img = document.getElementById(`rep-img-${drag.idx}`);Â 
Â  Â  Â  Â  Â  Â  Â  Â  if (img) img.style.objectPosition = `${nX}% ${nY}%`;Â 
Â  Â  Â  Â  Â  Â  Â  Â  const sX = document.getElementById(`slider-x-${drag.idx}`);Â 
Â  Â  Â  Â  Â  Â  Â  Â  const sY = document.getElementById(`slider-y-${drag.idx}`);Â 
Â  Â  Â  Â  Â  Â  Â  Â  if(sX) sX.value = nX; if(sY) sY.value = nY;Â 
Â  Â  Â  Â  Â  Â  });
Â  Â  Â  Â  }
Â  Â  Â  Â  function stopDrag() { drag.active = false; drag.idx = -1; if(rafId) cancelAnimationFrame(rafId); }

Â  Â  Â  Â  function updateStatus(status) {Â 
Â  Â  Â  Â  Â  Â  const el = document.getElementById('statusBar');Â 
Â  Â  Â  Â  Â  Â  el.classList.remove('hidden', 'bg-green-100', 'text-green-700', 'bg-orange-100', 'text-orange-700');Â 
Â  Â  Â  Â  Â  Â  if(status === 'online') { el.classList.add('bg-green-100', 'text-green-700'); el.innerHTML = "ğŸŸ¢ Ø¦Û†Ù†Ù„Ø§ÛŒÙ†"; state.isOnline = true; }Â 
Â  Â  Â  Â  Â  Â  else { el.classList.add('bg-orange-100', 'text-orange-700'); el.innerHTML = "ğŸŸ  Ù„Û†Ú©Ø§Úµ"; state.isOnline = false; }Â 
Â  Â  Â  Â  Â  Â  setTimeout(() => el.classList.add('hidden'), 4000);Â 
Â  Â  Â  Â  }

Â  Â  Â  Â  function calculateScale() {
Â  Â  Â  Â  Â  Â  if (!state.showReportModal && !state.showMonthModal) return;
Â  Â  Â  Â  Â  Â  const viewportWidth = window.innerWidth;
Â  Â  Â  Â  Â  Â  const wrapperPadding = 20;Â 
Â  Â  Â  Â  Â  Â  const targetWidth = viewportWidth - wrapperPadding;
Â  Â  Â  Â  Â  Â  const a4WidthPx = 794;Â 
Â  Â  Â  Â  Â  Â  if (targetWidth < a4WidthPx) { state.reportScale = targetWidth / a4WidthPx; } else { state.reportScale = 1; }
Â  Â  Â  Â  Â  Â  const page = document.querySelector('.a4-page');
Â  Â  Â  Â  Â  Â  const wrapper = document.querySelector('.report-wrapper');
Â  Â  Â  Â  Â  Â  if (page && wrapper) {Â 
Â  Â  Â  Â  Â  Â  Â  Â  page.style.transform = `scale(${state.reportScale})`;Â 
Â  Â  Â  Â  Â  Â  Â  Â  const scaledHeight = page.getBoundingClientRect().height;
Â  Â  Â  Â  Â  Â  Â  Â  wrapper.style.height = (scaledHeight + 50) + 'px';
Â  Â  Â  Â  Â  Â  }
Â  Â  Â  Â  }
Â  Â  Â  Â  window.addEventListener('resize', calculateScale);

Â  Â  Â  Â  // ===========================================
Â  Â  Â  Â  // [START 3] Ú¯Û†Ú•ÛŒÙ†ÛŒ ÙØ§Ù†Ú©Ø´Ù†Û•Ú©Ø§Ù†ÛŒ Firebase
Â  Â  Â  Â  // ===========================================

Â  Â  Â  Â  // A. Ø¨Ø§Ø±Ú©Ø±Ø¯Ù†ÛŒ Ø¯Ø§ØªØ§ Ù„Û• Firestore
Â  Â  Â  Â  async function loadActivities() {
Â  Â  Â  Â  Â  Â  const loadingTextEl = document.getElementById('loadingText');
Â  Â  Â  Â  Â  Â  loadingTextEl.innerText = "Ø¯Ø§ØªØ§Ú©Ø§Ù† Ù„Û• Firebase Ø¨Ø§Ø± Ø¯Û•Ú©Ø±ÛÙ†...";

Â  Â  Â  Â  Â  Â  try {
Â  Â  Â  Â  Â  Â  Â  Â  const snapshot = await db.collection(ACTIVITIES_COLLECTION).orderBy("date", "desc").get();
Â  Â  Â  Â  Â  Â  Â  Â  const data = snapshot.docs.map(doc => ({ 
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  id: doc.id, 
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  ...doc.data() 
Â  Â  Â  Â  Â  Â  Â  Â  }));
Â  Â  Â  Â  Â  Â  Â  Â  
Â  Â  Â  Â  Â  Â  Â  Â  if (Array.isArray(data)) { 
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  state.activities = data; 
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  updateStatus('online'); 
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  render(); 
Â  Â  Â  Â  Â  Â  Â  Â  }
Â  Â  Â  Â  Â  Â  } catch (error) { 
Â  Â  Â  Â  Â  Â  Â  Â  console.error("Ù‡Û•ÚµÛ• Ù„Û• Ø¨Ø§Ø±Ú©Ø±Ø¯Ù†ÛŒ Ø¯Ø§ØªØ§ Ù„Û• Firebase:", error);
Â  Â  Â  Â  Â  Â  Â  Â  updateStatus('offline'); 
Â  Â  Â  Â  Â  Â  Â  Â  loadingTextEl.innerText = "Ú©ÛØ´Û• Ù„Û• Ù¾Û•ÛŒÙˆÛ•Ø³ØªØ¨ÙˆÙˆÙ† Ø¨Û• Ø¯Ø§ØªØ§Ø¨Û•ÛŒØ³";
Â  Â  Â  Â  Â  Â  } finally {
Â  Â  Â  Â  Â  Â  Â  Â  loadingTextEl.innerText = "Ù¾Û•ÛŒÙˆÛ•Ø³Øª Ø¯Û•Ø¨ÛØª...";
Â  Â  Â  Â  Â  Â  }
Â  Â  Â  Â  }

Â  Â  Â  Â  // B. Ù†Ø§Ø±Ø¯Ù†ÛŒ Ú†Ø§Ù„Ø§Ú©ÛŒ Ù†ÙˆÛ Ø¨Û† Firestore
Â  Â  Â  Â  async function handleSubmit() {
Â  Â  Â  Â  Â  Â  if (!validateForm() || !state.form.lessonNumber) {
Â  Â  Â  Â  Â  Â  Â  Â  Â if (!state.form.lessonNumber) document.getElementById('lessonNumber').classList.add('input-error');
Â  Â  Â  Â  Â  Â  Â  Â  Â return;
Â  Â  Â  Â  Â  Â  } else {
Â  Â  Â  Â  Â  Â  Â  Â  Â document.getElementById('lessonNumber').classList.remove('input-error');
Â  Â  Â  Â  Â  Â  }
Â  Â  Â  Â  Â  Â  
Â  Â  Â  Â  Â  Â  // Ù¾Ø´Ú©Ù†ÛŒÙ†ÛŒ Ú†ÙˆÙˆÙ†Û•Ú˜ÙˆÙˆØ±Û•ÙˆÛ•
Â  Â  Â  Â  Â  Â  if (!firebase.auth().currentUser) {
Â  Â  Â  Â  Â  Â  Â  Â  alert("ØªÚ©Ø§ÛŒÛ• ÛŒÛ•Ú©Û•Ù… Ø¬Ø§Ø± Ø¨Ú†Û†Ø±Û• Ú˜ÙˆÙˆØ±Û•ÙˆÛ• Ø¨Û• Ø¦Û•Ú©Ø§ÙˆÙ†ØªÛŒ Ú¯Û†Ú¯Úµ Ø¨Û† Ù†Ø§Ø±Ø¯Ù†ÛŒ Ú†Ø§Ù„Ø§Ú©ÛŒ.");
Â  Â  Â  Â  Â  Â  Â  Â  return;
Â  Â  Â  Â  Â  Â  }

Â  Â  Â  Â  Â  Â  document.getElementById('loadingOverlay').classList.remove('hidden');
Â  Â  Â  Â  Â  Â Â 
Â  Â  Â  Â  Â  Â  const newActivity = {Â 
Â  Â  Â  Â  Â  Â  Â  Â  ...state.form,
Â  Â  Â  Â  Â  Â  Â  Â  lessonTime: state.form.lessonNumber,
Â  Â  Â  Â  Â  Â  Â  Â  teacherEmail: firebase.auth().currentUser.email,
Â  Â  Â  Â  Â  Â  Â  Â  timestamp: firebase.firestore.FieldValue.serverTimestamp()
Â  Â  Â  Â  Â  Â  };

Â  Â  Â  Â  Â  Â  try {
Â  Â  Â  Â  Â  Â  Â  Â  const docRef = await db.collection(ACTIVITIES_COLLECTION).add(newActivity);

Â  Â  Â  Â  Â  Â  Â  Â  state.activities.unshift({ ...newActivity, id: docRef.id }); 
Â  Â  Â  Â  Â  Â  Â  Â  
Â  Â  Â  Â  Â  Â  Â  Â  showNotification("ØªÛ†Ù…Ø§Ø±Ú©Ø±Ø§!", "Ø¨Û• Ø³Û•Ø±Ú©Û•ÙˆØªÙˆÙˆÛŒÛŒ Ù†ÛØ±Ø¯Ø±Ø§ Ø¨Û† Firebase");Â 
Â  Â  Â  Â  Â  Â  Â  Â  state.form = { teacherName: '', subject: '', activityName: '', dayOfWeek: '', lessonNumber: '', date: new Date().toISOString().split('T')[0] };Â 
Â  Â  Â  Â  Â  Â  Â  Â  updateStatus('online');Â 
Â  Â  Â  Â  Â  Â  } catch (e) { 
Â  Â  Â  Â  Â  Â  Â  Â  alert("Ú©ÛØ´Û• Ù„Û• Ù¾Û•ÛŒÙˆÛ•Ø³ØªØ¨ÙˆÙˆÙ† Ø¨Û• Firebase. Ø¯Ø§ØªØ§ Ù†Û•Ù†ÛØ±Ø¯Ø±Ø§."); 
Â  Â  Â  Â  Â  Â  Â  Â  console.error("Ù‡Û•ÚµÛ• Ù„Û• Ù†Ø§Ø±Ø¯Ù†ÛŒ Ø¯Ø§ØªØ§:", e);
Â  Â  Â  Â  Â  Â  Â  Â  updateStatus('offline'); 
Â  Â  Â  Â  Â  Â  } finally { 
Â  Â  Â  Â  Â  Â  Â  Â  document.getElementById('loadingOverlay').classList.add('hidden'); 
Â  Â  Â  Â  Â  Â  Â  Â  render(); 
Â  Â  Â  Â  Â  Â  }
Â  Â  Â  Â  }

Â  Â  Â  Â  // C. Ú†ÙˆÙˆÙ†Û•Ú˜ÙˆÙˆØ±Û•ÙˆÛ• Ø¨Û• Google
Â  Â  Â  Â  async function handleLogin() {
Â  Â  Â  Â  Â  Â  document.getElementById('loadingOverlay').classList.remove('hidden');
Â  Â  Â  Â  Â  Â  document.getElementById('loadingText').innerText = "Ú†ÙˆÙˆÙ†Û•Ú˜ÙˆÙˆØ±Û•ÙˆÛ• Ø¨Û• Ú¯Û†Ú¯Úµ...";

Â  Â  Â  Â  Â  Â  try {
Â  Â  Â  Â  Â  Â  Â  Â  const provider = new firebase.auth.GoogleAuthProvider();
Â  Â  Â  Â  Â  Â  Â  Â  provider.setCustomParameters({ prompt: 'select_account' });
Â  Â  Â  Â  Â  Â  Â  Â  
Â  Â  Â  Â  Â  Â  Â  Â  const result = await firebase.auth().signInWithPopup(provider);
Â  Â  Â  Â  Â  Â  Â  Â  const user = result.user;
Â  Â  Â  Â  Â  Â  Â  Â  const emailDomain = user.email.split('@')[1];

Â  Â  Â  Â  Â  Â  Â  Â  // Ù¾Ø´Ú©Ù†ÛŒÙ†ÛŒ Ú•ÛÚ¯Û•Ù¾ÛØ¯Ø±Ø§Ùˆ
Â  Â  Â  Â  Â  Â  Â  Â  if (user.email === ALLOWED_ADMIN_EMAIL || emailDomain.includes(TEACHER_DOMAIN)) { 
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  state.isAdminAuthenticated = true;
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  state.login = { username: '', password: '' };
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  showNotification("Ø¨Û•Ø®ÛØ±Ø¨ÛÛŒØª", `Ø³ÚµØ§ÙˆØŒ ${user.displayName}!`);
Â  Â  Â  Â  Â  Â  Â  Â  } else {
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  await firebase.auth().signOut(); 
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  alert(`âš ï¸ ØªÛ† Ù†Ø§ØªÙˆØ§Ù†ÛŒØª Ø¨Ú†ÛŒØªÛ• Ú˜ÙˆÙˆØ±Û•ÙˆÛ• Ø¨Û•Ù… Ø¦Û•Ú©Ø§ÙˆÙ†ØªÛ•. ØªÛ•Ù†Ù‡Ø§ Ø¦ÛŒÙ…Û•ÛŒÚµÛŒ Ù‚ÙˆØªØ§Ø¨Ø®Ø§Ù†Û• Ú•ÛÚ¯Û•Ù¾ÛØ¯Ø±Ø§ÙˆÛ•.`);
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  state.isAdminAuthenticated = false;
Â  Â  Â  Â  Â  Â  Â  Â  }

Â  Â  Â  Â  Â  Â  } catch (error) {
Â  Â  Â  Â  Â  Â  Â  Â  if (error.code !== 'auth/popup-closed-by-user') {
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  alert("Ú©ÛØ´Û• Ù„Û• Ú†ÙˆÙˆÙ†Û•Ú˜ÙˆÙˆØ±Û•ÙˆÛ•ÛŒ Ú¯Û†Ú¯Úµ. ØªÚ©Ø§ÛŒÛ• Ø¯ÙˆØ¨Ø§Ø±Û• Ù‡Û•ÙˆÚµ Ø¨Ø¯Û•ÙˆÛ•.");
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  console.error("Google Auth Error:", error);
Â  Â  Â  Â  Â  Â  Â  Â  }
Â  Â  Â  Â  Â  Â  } finally {
Â  Â  Â  Â  Â  Â  Â  Â  document.getElementById('loadingOverlay').classList.add('hidden');
Â  Â  Â  Â  Â  Â  Â  Â  document.getElementById('loadingText').innerText = "Ù¾Û•ÛŒÙˆÛ•Ø³Øª Ø¯Û•Ø¨ÛØª...";
Â  Â  Â  Â  Â  Â  Â  Â  render(); 
Â  Â  Â  Â  Â  Â  }
Â  Â  Â  Â  }

Â  Â  Â  Â  // D. Ø¯Û•Ø±Ú†ÙˆÙˆÙ†
Â  Â  Â  Â  function handleLogout() { 
Â  Â  Â  Â  Â  Â  firebase.auth().signOut().then(() => {
Â  Â  Â  Â  Â  Â  Â  Â  state.isAdminAuthenticated = false; 
Â  Â  Â  Â  Â  Â  Â  Â  state.currentView = 'teacher'; 
Â  Â  Â  Â  Â  Â  Â  Â  showNotification("Ø¯Û•Ø±Ú†ÙˆÙˆ", "Ø¨Û• Ø³Û•Ø±Ú©Û•ÙˆØªÙˆÙˆÛŒÛŒ Ø¯Û•Ø±Ú†ÙˆÙˆÛŒ");
Â  Â  Â  Â  Â  Â  Â  Â  render(); 
Â  Â  Â  Â  Â  Â  }).catch((error) => {
Â  Â  Â  Â  Â  Â  Â  Â  alert("Ú©ÛØ´Û• Ù„Û• Ø¯Û•Ø±Ú†ÙˆÙˆÙ†");
Â  Â  Â  Â  Â  Â  });
Â  Â  Â  Â  }

Â  Â  Â  Â  // E. Ø³Ú•ÛŒÙ†Û•ÙˆÛ•ÛŒ Ú†Ø§Ù„Ø§Ú©ÛŒ (ØªÛ•Ù†Ù‡Ø§ Ø¨Û† Ø¦Û•Ø¯Ù…ÛŒÙ†)
Â  Â  Â  Â  async function deleteActivity(id) { 
Â  Â  Â  Â  Â  Â  if(!firebase.auth().currentUser || firebase.auth().currentUser.email !== ALLOWED_ADMIN_EMAIL) {
Â  Â  Â  Â  Â  Â  Â  Â  alert("Ù…Û†ÚµÛ•ØªÛŒ Ø³Ú•ÛŒÙ†Û•ÙˆÛ•ÛŒ Ø¦Û•Ù… Ø¯Ø§ØªØ§ÛŒÛ•Øª Ù†ÛŒÛŒÛ•. ØªÛ•Ù†Ù‡Ø§ Ø¦Û•Ø¯Ù…ÛŒÙ† Ú•ÛÚ¯Û•Ù¾ÛØ¯Ø±Ø§ÙˆÛ•.");
Â  Â  Â  Â  Â  Â  Â  Â  return;
Â  Â  Â  Â  Â  Â  }
Â  Â  Â  Â  Â  Â  
Â  Â  Â  Â  Â  Â  if(confirm("Ø¯ÚµÙ†ÛŒØ§ÛŒØªØŸ Ø¦Û•Ù… Ú†Ø§Ù„Ø§Ú©ÛŒÛ• Ø¨Û• ØªÛ•ÙˆØ§ÙˆÛŒ Ù„Û• Ø¯Ø§ØªØ§Ø¨Û•ÛŒØ³ Ø¯Û•Ø³Ú•Ø¯Ø±ÛØªÛ•ÙˆÛ•!")) { 
Â  Â  Â  Â  Â  Â  Â  Â  document.getElementById('loadingOverlay').classList.remove('hidden');
Â  Â  Â  Â  Â  Â  Â  Â  try {
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  await db.collection(ACTIVITIES_COLLECTION).doc(id).delete();

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  state.activities = state.activities.filter(a => a.id != id); 
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  showNotification("Ø³Ú•Ø§ÛŒÛ•ÙˆÛ•", "Ú†Ø§Ù„Ø§Ú©ÛŒÛ•Ú©Û• Ø¨Û• Ø³Û•Ø±Ú©Û•ÙˆØªÙˆÙˆÛŒÛŒ Ø³Ú•Ø§ÛŒÛ•ÙˆÛ• Ù„Û• Firebase"); 
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  render(); 
Â  Â  Â  Â  Â  Â  Â  Â  } catch (e) { 
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  alert("Ù†Û•ØªÙˆØ§Ù†Ø±Ø§ Ø¨Ø³Ú•Ø¯Ø±ÛØªÛ•ÙˆÛ•. (Ù‡Û•ÚµÛ• Ù„Û• Ú•ÛÚ¯Û•Ù¾ÛØ¯Ø±Ø§ÙˆÛŒ Firestore)."); 
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  console.error("Ù‡Û•ÚµÛ• Ù„Û• Ø³Ú•ÛŒÙ†Û•ÙˆÛ•ÛŒ Firebase:", e);
Â  Â  Â  Â  Â  Â  Â  Â  } finally { 
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  document.getElementById('loadingOverlay').classList.add('hidden'); 
Â  Â  Â  Â  Â  Â  Â  Â  }
Â  Â  Â  Â  Â  Â  } 
Â  Â  Â  Â  }
Â  Â  Â  Â  
Â  Â  Â  Â  // F. Ù¾Ø´Ú©Ù†ÛŒÙ†ÛŒ Ø¯Û†Ø®ÛŒ Ú†ÙˆÙˆÙ†Û•Ú˜ÙˆÙˆØ±Û•ÙˆÛ• (Ù„Û• Ú©Ø§ØªÛŒ Ø¨Ø§Ø±Ú©Ø±Ø¯Ù†ÛŒ Ù„Ø§Ù¾Û•Ú•Û•Ø¯Ø§)
Â  Â  Â  Â  firebase.auth().onAuthStateChanged(function(user) {
Â  Â  Â  Â  Â  if (user) {
Â  Â  Â  Â  Â  Â  const emailDomain = user.email.split('@')[1];
Â  Â  Â  Â  Â  Â  if (user.email === ALLOWED_ADMIN_EMAIL || emailDomain.includes(TEACHER_DOMAIN)) {
Â  Â  Â  Â  Â  Â  Â  Â  state.isAdminAuthenticated = true;
Â  Â  Â  Â  Â  Â  } else {
Â  Â  Â  Â  Â  Â  Â  Â  firebase.auth().signOut(); // Ø¯Û•Ø±Ú†ÙˆÙˆÙ†
Â  Â  Â  Â  Â  Â  Â  Â  state.isAdminAuthenticated = false;
Â  Â  Â  Â  Â  Â  }
Â  Â  Â  Â  Â  } else {
Â  Â  Â  Â  Â  Â  state.isAdminAuthenticated = false;
Â  Â  Â  Â  Â  }
Â  Â  Â  Â  Â  render(); 
Â  Â  Â  Â  Â  if (state.activities.length === 0) loadActivities(); // Ø¯Ø§ØªØ§ Ø¨Ø§Ø± Ø¨Ú©Û•
Â  Â  Â  Â  });

Â  Â  Â  Â  // [END 3] Ú¯Û†Ú•ÛŒÙ†ÛŒ ÙØ§Ù†Ú©Ø´Ù†Û•Ú©Ø§Ù†ÛŒ Firebase

Â  Â  Â  Â  // ... Ø¨Ø§Ù‚ÛŒ ÙØ§Ù†Ú©Ø´Ù†Û•Ú©Ø§Ù† (downloadElementAsImage, handleImage, updateImg, validateForm, showNotification) ÙˆÛ•Ú© Ø®Û†ÛŒØ§Ù†Ù† ...
Â  Â  Â  Â  function downloadElementAsImage(id, name) {
Â  Â  Â  Â  Â  Â  const el = document.getElementById(id);
Â  Â  Â  Â  Â  Â  if(!el) return;
Â  Â  Â  Â  Â  Â  const btn = document.activeElement;
Â  Â  Â  Â  Â  Â  const txt = btn ? btn.innerText : '';
Â  Â  Â  Â  Â  Â  if(btn) btn.innerText = '...';
Â  Â  Â  Â  Â  Â  const originalTransform = el.style.transform;
Â  Â  Â  Â  Â  Â  el.style.transform = 'none';Â 
Â  Â  Â  Â  Â  Â Â 
Â  Â  Â  Â  Â  Â  const inputs = el.querySelectorAll('input');
Â  Â  Â  Â  Â  Â  inputs.forEach(i => { const s = document.createElement('span'); s.innerText = i.value; s.className = 'print-text-temp font-bold text-gray-900 ' + i.className; s.style.fontSize = window.getComputedStyle(i).fontSize; s.style.display = 'block'; i.style.display = 'none'; i.parentNode.insertBefore(s, i); });
Â  Â  Â  Â  Â  Â Â 
Â  Â  Â  Â  Â  Â  html2canvas(el, { scale: 2, useCORS: true, allowTaint: true, backgroundColor: '#ffffff' }).then(c => {Â 
Â  Â  Â  Â  Â  Â  Â  Â  c.toBlob(function(blob) {
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  const url = URL.createObjectURL(blob);
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  const l = document.createElement('a'); l.download = name.replace('.png', '.jpg'); l.href = url;
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  document.body.appendChild(l); l.click(); document.body.removeChild(l); URL.revokeObjectURL(url);
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  document.querySelectorAll('.print-text-temp').forEach(s => s.remove()); inputs.forEach(i => i.style.display = '');Â 
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  el.style.transform = originalTransform;Â 
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  if(btn) btn.innerText = txt;Â 
Â  Â  Â  Â  Â  Â  Â  Â  }, 'image/jpeg', 0.9);
Â  Â  Â  Â  Â  Â  }).catch(e => { alert("Ú©ÛØ´Û• Ù„Û• Ø¯Ø±ÙˆØ³ØªÚ©Ø±Ø¯Ù†ÛŒ ÙˆÛÙ†Û•"); el.style.transform = originalTransform; if(btn) btn.innerText = txt; });
Â  Â  Â  Â  }

Â  Â  Â  Â  function handleImage(input, idx) {Â 
Â  Â  Â  Â  Â  Â  if(input.files[0]) { const r = new FileReader(); r.onload = (e) => { state.report.images[idx] = e.target.result; state.report.imgSettings[idx] = {zoom: 1, x: 50, y: 50}; render(); }; r.readAsDataURL(input.files[0]); }Â 
Â  Â  Â  Â  }

Â  Â  Â  Â  function updateImg(idx, prop, val) {Â 
Â  Â  Â  Â  Â  Â  state.report.imgSettings[idx][prop] = val;Â 
Â  Â  Â  Â  Â  Â  const img = document.getElementById(`rep-img-${idx}`);
Â  Â  Â  Â  Â  Â  if(img) { if(prop==='zoom') img.style.transform = `scale(${val})`; else img.style.objectPosition = `${state.report.imgSettings[idx].x}% ${state.report.imgSettings[idx].y}%`; }
Â  Â  Â  Â  }
Â  Â  Â  Â Â 
Â  Â  Â  Â  function validateForm() {Â 
Â  Â  Â  Â  Â  Â  let valid = true;Â 
Â  Â  Â  Â  Â  Â  ['teacherName', 'subject', 'activityName', 'dayOfWeek'].forEach(id => { const el = document.getElementById(id); if(!state.form[id] || state.form[id] === '') { if(el) el.classList.add('input-error'); valid = false; } else if(el) el.classList.remove('input-error'); });Â 
Â  Â  Â  Â  Â  Â  if(!state.form.lessonNumber || state.form.lessonNumber === '') { document.getElementById('lessonNumber').classList.add('input-error'); valid = false; } else { document.getElementById('lessonNumber').classList.remove('input-error'); }
Â  Â  Â  Â  Â  Â  return valid;Â 
Â  Â  Â  Â  }

Â  Â  Â  Â  function showNotification(title, msg) {Â 
Â  Â  Â  Â  Â  Â  const n = document.getElementById('notification'); document.getElementById('notifTitle').innerText = title; document.getElementById('notifText').innerText = msg; n.classList.remove('hidden'); setTimeout(() => n.classList.add('hidden'), 3000);Â 
Â  Â  Â  Â  }

Â  Â  Â  Â  function openReportFor(id) {
Â  Â  Â  Â  Â  Â  const act = state.activities.find(a => a.id == id);
Â  Â  Â  Â  Â  Â  if(act) { state.report.teacherName = act.teacherName; state.report.activityName = act.activityName; state.report.date = act.date; state.showReportModal = true; render(); }
Â  Â  Â  Â  }

Â  Â  Â  Â  // --- Render Functions (ÙˆÛ•Ú© Ø®Û†ÛŒØ§Ù† Ù…Ø§ÙˆÙ†Û•ØªÛ•ÙˆÛ•) ---

Â  Â  Â  Â  function Header() {Â 
Â  Â  Â  Â  Â  Â  const themeIcon = state.theme === 'light' ? 'ğŸŒ™' : 'â˜€ï¸';
Â  Â  Â  Â  Â  Â  const themeTitle = state.theme === 'light' ? 'Ø¯Û†Ø®ÛŒ ØªØ§Ø±ÛŒÚ©' : 'Ø¯Û†Ø®ÛŒ Ú•ÙˆÙˆÙ†';
Â  Â  Â  Â  Â  Â Â 
Â  Â  Â  Â  Â  Â  // Only show Toggle Button in Teacher View
Â  Â  Â  Â  Â  Â  const showToggle = state.currentView === 'teacher';

Â  Â  Â  Â  Â  Â  return `
Â  Â  Â  Â  Â  Â  <div class="school-header text-white py-6 px-4 mb-6 md:mb-8 transition-all duration-500">
Â  Â  Â  Â  Â  Â  Â  Â  <div class="max-w-6xl mx-auto">
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <div class="flex items-center justify-between">
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <div class="flex items-center gap-3 md:gap-5">
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <div class="w-16 h-16 md:w-20 md:h-20 bg-white rounded-2xl flex items-center justify-center shadow-lg p-2 hover:scale-105 transition-transform duration-300">
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <img src="${LOGO_URL}" alt="Logo" class="w-full h-full object-contain">
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  </div>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <div>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <h1 class="text-xl md:text-3xl font-black drop-shadow-md tracking-tight">Ù‚ÙˆØªØ§Ø¨Ø®Ø§Ù†Û•ÛŒ Ú¯Ø²Ù†Ú¯</h1>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <p class="text-blue-100 text-xs md:text-base drop-shadow font-medium opacity-90">Ø³ÛŒØ³ØªÛ•Ù…ÛŒ Ú†Ø§Ù„Ø§Ú©ÛŒÛ•Ú©Ø§Ù†</p>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  </div>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  </div>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <div class="flex items-center gap-2">
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â ${showToggle ? `<button onclick="toggleTheme()" title="${themeTitle}" class="bg-white/20 hover:bg-white/30 w-10 h-10 flex items-center justify-center rounded-xl text-lg backdrop-blur-sm active:scale-95 transition-all border border-white/10 shadow-lg">${themeIcon}</button>` : ''}
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  ${state.isAdminAuthenticated ? `<button onclick="handleLogout()" class="btn-white bg-white/20 hover:bg-white/30 px-3 py-1.5 md:px-5 md:py-2 rounded-xl text-xs md:text-sm font-bold transition backdrop-blur-sm active:scale-95">Ø¯Û•Ø±Ú†ÙˆÙˆÙ†</button>` : ''}
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  </div>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  </div>
Â  Â  Â  Â  Â  Â  Â  Â  </div>
Â  Â  Â  Â  Â  Â  </div>`;Â 
Â  Â  Â  Â  }
Â  Â  Â  Â Â 
Â  Â  Â  Â  function Navigation() {Â 
Â  Â  Â  Â  Â  Â  const navClass = state.currentView === 'admin'Â 
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â ? '!bg-slate-800 !border-slate-700'Â 
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â : (state.theme === 'dark' ? '!bg-slate-800 !border-slate-700' : '');

Â  Â  Â  Â  Â  Â  return `
Â  Â  Â  Â  Â  Â  <div class="max-w-6xl mx-auto px-4 mb-6">
Â  Â  Â  Â  Â  Â  Â  Â  <div class="bg-white rounded-2xl p-2 flex gap-2 shadow-sm border border-gray-100 overflow-x-auto justify-center sticky top-24 z-30 transition-colors duration-500 ${navClass}">
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <button onclick="state.currentView='teacher'; render()" class="btn-white w-full md:w-auto md:px-10 py-3 rounded-xl font-bold text-xs md:text-sm whitespace-nowrap ${state.currentView === 'teacher' ? 'active' : ''}">Ù…Ø§Ù…Û†Ø³ØªØ§</button>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <button onclick="state.currentView='admin'; render()" class="btn-white w-full md:w-auto md:px-10 py-3 rounded-xl font-bold text-xs md:text-sm whitespace-nowrap ${state.currentView === 'admin' ? 'active' : ''}">Ø¦Û•Ø¯Ù…ÛŒÙ†</button>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <button onclick="window.open('https://gzng-archive.vercel.app/', '_blank')" class="btn-white w-full md:w-auto md:px-10 py-3 rounded-xl font-bold text-xs md:text-sm whitespace-nowrap">ğŸ“‚ Ø¦Û•Ø±Ø´ÛŒÙ</button>
Â  Â  Â  Â  Â  Â  Â  Â  </div>
Â  Â  Â  Â  Â  Â  </div>`;Â 
Â  Â  Â  Â  }

Â  Â  Â  Â  function renderTeacherView() {
Â  Â  Â  Â  Â  Â  const days = ['Ø´Û•Ù…Ù…Û•', 'ÛŒÛ•Ú©Ø´Û•Ù…Ù…Û•', 'Ø¯ÙˆÙˆØ´Û•Ù…Ù…Û•', 'Ø³ÛØ´Û•Ù…Ù…Û•', 'Ú†ÙˆØ§Ø±Ø´Û•Ù…Ù…Û•', 'Ù¾ÛÙ†Ø¬Ø´Û•Ù…Ù…Û•', 'Ù‡Û•ÛŒÙ†ÛŒ'];
Â  Â  Â  Â  Â  Â  const lessons = ['ÙˆØ§Ù†Û•ÛŒ ÛŒÛ•Ú©Û•Ù…', 'ÙˆØ§Ù†Û•ÛŒ Ø¯ÙˆÙˆÛ•Ù…', 'ÙˆØ§Ù†Û•ÛŒ Ø³ÛÛŒÛ•Ù…', 'ÙˆØ§Ù†Û•ÛŒ Ú†ÙˆØ§Ø±Û•Ù…', 'ÙˆØ§Ù†Û•ÛŒ Ù¾ÛÙ†Ø¬Û•Ù…', 'ÙˆØ§Ù†Û•ÛŒ Ø´Û•Ø´Û•Ù…'];Â 
Â  Â  Â  Â  Â  Â  if (!state.viewDay) state.viewDay = 'Ø´Û•Ù…Ù…Û•';
Â  Â  Â  Â  Â  Â  const dailyActivities = state.activities.filter(a => a.dayOfWeek === state.viewDay);
Â  Â  Â  Â  Â  Â Â 
Â  Â  Â  Â  Â  Â  return `
Â  Â  Â  Â  Â  Â  <div class="w-full max-w-6xl mx-auto px-4 pb-20">
Â  Â  Â  Â  Â  Â  Â  Â  <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â Â 
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <div class="bg-white rounded-2xl shadow-sm p-5 md:p-8 border border-gray-100 h-fit hover:shadow-md transition-shadow duration-300">
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <h3 class="font-bold text-gray-800 mb-4 border-b pb-2 flex items-center gap-2"><span class="text-blue-500 text-xl">+</span>ØªÛ†Ù…Ø§Ø±Ú©Ø±Ø¯Ù†ÛŒ Ú†Ø§Ù„Ø§Ú©ÛŒ Ù†ÙˆÛ</h3>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  ${firebase.auth().currentUser ? `
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <div class="bg-green-50 p-3 rounded-xl mb-4 text-center border border-green-100">
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <p class="text-sm font-bold text-green-700">Ú†ÙˆÙˆÛŒØªÙ‡ Ú˜ÙˆÙˆØ±Ù‡â€ŒÙˆÙ‡â€Œ Ø¨Ù‡â€Œ: ${firebase.auth().currentUser.displayName || firebase.auth().currentUser.email}</p>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  </div>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <div class="space-y-4">
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <div class="space-y-1"><label class="text-sm font-bold text-gray-600">Ù†Ø§ÙˆÛŒ Ù…Ø§Ù…Û†Ø³ØªØ§</label><input type="text" id="teacherName" oninput="state.form.teacherName = this.value" value="${state.form.teacherName}" class="input-field w-full rounded-xl bg-gray-50 px-4 py-3 text-right text-gray-800 font-bold placeholder-gray-400" placeholder="Ù†Ø§ÙˆÛŒ Ø®Û†Øª Ø¨Ù†ÙˆÙˆØ³Û•..."></div>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â Â 
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <div class="grid grid-cols-2 gap-4">
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <div class="space-y-1">
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <label class="text-sm font-bold text-gray-600">Ú•Û†Ú˜</label>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <select id="dayOfWeek" onchange="state.form.dayOfWeek = this.value" class="input-field w-full rounded-xl bg-gray-50 px-4 py-3 text-right text-gray-800 font-bold cursor-pointer">
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <option value="">Ù‡Û•ÚµØ¨Ú˜ÛØ±Û•...</option>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  ${days.map(d => `<option value="${d}" ${state.form.dayOfWeek === d ? 'selected' : ''}>${d}</option>`).join('')}
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  </select>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  </div>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <div class="space-y-1">
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <label class="text-sm font-bold text-gray-600">Ø¯Û•Ø±Ø³</label>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <select id="lessonNumber" onchange="state.form.lessonNumber = this.value" class="input-field w-full rounded-xl bg-gray-50 px-4 py-3 text-center text-gray-800 font-bold cursor-pointer">
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <option value="">Ù‡Û•ÚµØ¨Ú˜ÛØ±Û•...</option>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  ${lessons.map(l => `<option value="${l}" ${state.form.lessonNumber === l ? 'selected' : ''}>${l}</option>`).join('')}
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  </select>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  </div>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  </div>

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <div class="space-y-1"><label class="text-sm font-bold text-gray-600">Ø¨Ø§Ø¨Û•Øª</label><input type="text" id="subject" oninput="state.form.subject = this.value" value="${state.form.subject}" class="input-field w-full rounded-xl bg-gray-50 px-4 py-3 text-right text-gray-800 font-bold" placeholder="Ø¨ÛŒØ±Ú©Ø§Ø±ÛŒ..."></div>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <div class="space-y-1"><label class="text-sm font-bold text-gray-600">Ø¬Û†Ø±ÛŒ Ú†Ø§Ù„Ø§Ú©ÛŒ</label><input type="text" id="activityName" oninput="state.form.activityName = this.value" value="${state.form.activityName}" class="input-field w-full rounded-xl bg-gray-50 px-4 py-3 text-right text-gray-800 font-bold" placeholder="ÙˆØ§Ù†Û•ÛŒ Ù†Ù…ÙˆÙˆÙ†Û•ÛŒÛŒ..."></div>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â Â 
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <div class="space-y-1">
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <label class="text-sm font-bold text-gray-600">Ø¨Û•Ø±ÙˆØ§Ø±</label>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <input type="date" id="date" oninput="state.form.date = this.value" value="${state.form.date}" class="input-field w-full rounded-xl bg-gray-50 px-4 py-3 text-center text-gray-800 font-bold font-mono cursor-pointer">
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  </div>

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <button onclick="handleSubmit()" class="btn-blue w-full font-black py-4 rounded-xl shadow-lg transition-all text-lg mt-4">ØªÛ†Ù…Ø§Ø±Ú©Ø±Ø¯Ù†</button>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  </div>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  ` : `
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <div class="flex flex-col items-center justify-center p-8 text-center bg-blue-50 rounded-xl border border-blue-200">
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <svg class="w-12 h-12 text-blue-600 mb-4" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 11c0 3.314-2.686 6-6 6s-6-2.686-6-6 2.686-6 6-6 6 2.686 6 6z"/><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 11V3"/></svg>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <h4 class="font-bold text-gray-800 mb-2">ØªÚ©Ø§ÛŒÛ• Ø¨Ú†Û†Ø±Û• Ú˜ÙˆÙˆØ±Û•ÙˆÛ•</h4>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <p class="text-gray-600 mb-4 text-sm">Ø¨Û† Ø¦Û•ÙˆÛ•ÛŒ Ú†Ø§Ù„Ø§Ú©ÛŒ ØªÛ†Ù…Ø§Ø± Ø¨Ú©Û•ÛŒØªØŒ Ù¾ÛÙˆÛŒØ³ØªÛ• Ø¨Û• Ø¦Û•Ú©Ø§ÙˆÙ†ØªÛŒ Ú¯Û†Ú¯ÚµÛ•Ú©Û•Øª Ø¨Ú†ÛŒØªÛ• Ú˜ÙˆÙˆØ±Û•ÙˆÛ•.</p>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <button onclick="handleLogin()" class="btn-blue w-full font-bold py-3 rounded-xl shadow-lg transition-all flex items-center justify-center gap-2">
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <svg class="w-5 h-5" viewBox="0 0 24 24" fill="currentColor"><path d="M22.5 12.583C22.5 11.815 22.434 11.047 22.316 10.292H12V14.63H18.784C18.492 16.143 17.65 17.433 16.51 18.283L16.51 18.349 19.988 20.978C22.05 19.096 23.25 16.545 23.25 13.5C23.25 13.064 23.218 12.628 23.15 12.195H22.5ZM12 4.75C14.07 4.75 15.895 5.46 17.26 6.83L20.428 3.66C18.675 1.91 16.3 1 12 1C7.7 1 4.075 2.942 2.08 6.01L5.617 8.783C6.678 7.228 9.1 4.75 12 4.75ZM12 23C7.625 23 4.062 21.058 2.062 17.99L5.599 15.217C6.66 16.772 9.085 19.25 12 19.25C14.47 19.25 16.56 18.23 18.067 16.897L21.6 19.67C19.56 21.84 16 23 12 23ZM1 13.5C1 12.723 1.15 11.97 1.408 11.25H4.76V14.61H1.408C1.15 13.9 1 13.147 1 12.375V13.5Z" fill="white"/></svg>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Ú†ÙˆÙˆÙ†Û•Ú˜ÙˆÙˆØ±Û•ÙˆÛ• Ø¨Û• Ø¦Û•Ú©Ø§ÙˆÙ†ØªÛŒ Ú¯Û†Ú¯Úµ
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  </button>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  </div>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  `}
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  </div>

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <div class="bg-gray-50 md:bg-white rounded-2xl md:shadow-sm md:p-8 md:border md:border-gray-100">
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <h3 class="text-center font-bold text-gray-800 mb-4 text-lg hidden md:block border-b pb-2">Ø®Ø´ØªÛ•ÛŒ Ú†Ø§Ù„Ø§Ú©ÛŒÛ•Ú©Ø§Ù†</h3>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <div class="flex gap-2 overflow-x-auto pb-4 no-scrollbar mb-2" style="-webkit-overflow-scrolling: touch;">${days.map(day => `<button onclick="state.viewDay='${day}'; render()" class="btn-white px-5 py-2 rounded-xl font-bold text-xs whitespace-nowrap ${state.viewDay === day ? 'active' : ''}">${day}</button>`).join('')}</div>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <div class="space-y-4">
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  ${dailyActivities.sort((a,b) => (a.lessonNumber > b.lessonNumber) ? 1 : ((b.lessonNumber > a.lessonNumber) ? -1 : 0)).map(a => `
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <div class="bg-white p-4 rounded-xl shadow-sm border border-gray-100 flex justify-between items-center transition-all duration-300 hover:shadow-md">
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <div>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <p class="font-bold text-gray-800">${a.teacherName}</p>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <p class="text-xs text-gray-500">${a.activityName} (${a.subject})</p>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <span class="text-xs font-mono text-blue-600">${getLessonName(a)}</span>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  </div>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <div class="flex items-center gap-2">
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <button onclick="openReportFor(${a.id})" class="btn-white px-3 py-1.5 rounded-lg text-xs font-bold shadow-sm">Ú•Ø§Ù¾Û†Ø±Øª</button>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  ${firebase.auth().currentUser && firebase.auth().currentUser.email === ALLOWED_ADMIN_EMAIL ? `<button onclick="deleteActivity('${a.id}')" class="bg-red-500 text-white hover:bg-red-600 px-3 py-1.5 rounded-lg text-xs font-bold shadow-sm">Ø³Ú•ÛŒÙ†Û•ÙˆÛ•</button>` : ''}
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  </div>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  </div>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  `).join('')}
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  ${dailyActivities.length === 0 ? '<p class="text-center text-gray-500 p-6 bg-white rounded-xl shadow-sm border border-gray-100">Ù‡ÛŒÚ† Ú†Ø§Ù„Ø§Ú©ÛŒÛ•Ú© Ù†ÛŒÛŒÛ• Ù„Û•Ù… Ú•Û†Ú˜Û•Ø¯Ø§.</p>' : ''}
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  </div>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  </div>

Â  Â  Â  Â  Â  Â  Â  Â  </div>
Â  Â  Â  Â  Â  Â  </div>`;
Â  Â  Â  Â  }
Â  Â  Â  Â Â 
Â  Â  Â  Â  // ... Ø¨Ø§Ù‚ÛŒ ÙØ§Ù†Ú©Ø´Ù†Û•Ú©Ø§Ù†ÛŒ renderAdminView, renderReportModal, render... ÙˆÛ•Ú© Ø®Û†ÛŒØ§Ù† Ù…Ø§ÙˆÙ†Û•ØªÛ•ÙˆÛ•.
Â  Â  Â  Â  
Â  Â  Â  Â  function renderAdminView() {
Â  Â  Â  Â  Â  Â  if (firebase.auth().currentUser && firebase.auth().currentUser.email === ALLOWED_ADMIN_EMAIL) {
Â  Â  Â  Â  Â  Â  Â  Â  const filteredActivities = state.activities.filter(a => a.date.startsWith(state.filterDate));
Â  Â  Â  Â  Â  Â  Â  Â  return `
Â  Â  Â  Â  Â  Â  Â  Â  <div class="w-full max-w-6xl mx-auto px-4 pb-20">
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <div class="admin-card bg-white rounded-2xl shadow-lg p-5 md:p-8 border border-gray-100">
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <h3 class="font-bold text-xl mb-4 border-b pb-2 text-purple-400">ğŸ“Š Ù„ÛŒØ³ØªÛŒ ØªÛ•ÙˆØ§ÙˆÛŒ Ú†Ø§Ù„Ø§Ú©ÛŒÛ•Ú©Ø§Ù† (Ø¦Û•Ø¯Ù…ÛŒÙ†)</h3>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <div class="flex flex-col md:flex-row gap-3 md:gap-4 items-end mb-6">
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <div class="space-y-1 w-full md:w-auto flex-grow">
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <label class="text-sm font-bold text-gray-400">ÙÛŒÙ„ØªÛ•Ø±Ú©Ø±Ø¯Ù† Ø¨Û•Ù¾ÛÛŒ Ù…Ø§Ù†Ú¯</label>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <input type="month" onchange="state.filterDate = this.value; render()" value="${state.filterDate}" class="input-field w-full rounded-xl bg-slate-800 px-4 py-3 text-center text-white font-bold font-mono cursor-pointer">
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  </div>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <button onclick="state.filterDate = ''; render()" class="btn-white w-full md:w-auto px-5 py-3 rounded-xl font-bold text-sm transition flex-shrink-0">Ø³Ú•ÛŒÙ†Û•ÙˆÛ•ÛŒ ÙÛŒÙ„ØªÛ•Ø±</button>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <button onclick="state.showSchedule = true; render()" class="btn-white w-full md:w-auto px-5 py-3 rounded-xl font-bold text-sm transition flex-shrink-0 bg-blue-600 text-white hover:bg-blue-700">Ø¨ÛŒÙ†ÛŒÙ†ÛŒ Ø®Ø´ØªÛ•</button>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  </div>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â Â 
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <div class="overflow-x-auto rounded-xl shadow-inner border border-slate-700">
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <table class="w-full text-right whitespace-nowrap">
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <thead class="bg-slate-700 text-white sticky top-0">
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <tr>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <th class="py-3 px-4 font-bold text-sm">Ø¨Û•Ø±ÙˆØ§Ø±</th>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <th class="py-3 px-4 font-bold text-sm">Ú•Û†Ú˜</th>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <th class="py-3 px-4 font-bold text-sm">Ù…Ø§Ù…Û†Ø³ØªØ§</th>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <th class="py-3 px-4 font-bold text-sm">Ø¯Û•Ø±Ø³</th>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <th class="py-3 px-4 font-bold text-sm">Ø¨Ø§Ø¨Û•Øª</th>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <th class="py-3 px-4 font-bold text-sm">Ú†Ø§Ù„Ø§Ú©ÛŒ</th>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <th class="py-3 px-4 font-bold text-sm">Ú©Ø±Ø¯Ø§Ø±</th>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  </tr>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  </thead>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <tbody>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  ${filteredActivities.map(a => `
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <tr class="border-b border-slate-700 hover:bg-slate-800 transition-colors duration-200">
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <td class="py-3 px-4 text-xs font-mono">${a.date}</td>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <td class="py-3 px-4 text-xs">${a.dayOfWeek}</td>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <td class="py-3 px-4 text-xs font-bold text-indigo-300">${a.teacherName}</td>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <td class="py-3 px-4 text-xs">${getLessonName(a)}</td>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <td class="py-3 px-4 text-xs">${a.subject}</td>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <td class="py-3 px-4 text-xs">${a.activityName}</td>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <td class="py-3 px-4">
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <div class="flex gap-2">
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <button onclick="openReportFor('${a.id}')" class="btn-white px-3 py-1.5 rounded-lg text-xs font-bold shadow-sm">Ú•Ø§Ù¾Û†Ø±Øª</button>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <button onclick="deleteActivity('${a.id}')" class="bg-red-600 text-white hover:bg-red-700 px-3 py-1.5 rounded-lg text-xs font-bold shadow-sm">Ø³Ú•ÛŒÙ†Û•ÙˆÛ•</button>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  </div>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  </td>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  </tr>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  `).join('')}
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  </tbody>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  </table>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  </div>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  </div>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  ${ScheduleModal()}
Â  Â  Â  Â  Â  Â  Â  Â  </div>
Â  Â  Â  Â  Â  Â  Â  Â  `;
Â  Â  Â  Â  Â  Â  }
Â  Â  Â  Â  Â  Â  return `
Â  Â  Â  Â  Â  Â  Â  Â  <div class="w-full max-w-6xl mx-auto px-4 pb-20">
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <div class="bg-white rounded-2xl shadow-lg p-8 text-center mt-10">
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <h3 class="font-bold text-gray-800 text-2xl mb-4">Ù¾ÛÙˆÛŒØ³ØªÛ• Ø¨Ú†ÛŒØªÛ• Ú˜ÙˆÙˆØ±Û•ÙˆÛ• ÙˆÛ•Ú© Ø¦Û•Ø¯Ù…ÛŒÙ†</h3>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <p class="text-gray-600 mb-6">Ø¨Û† Ø¨ÛŒÙ†ÛŒÙ†ÛŒ Ø¦Û•Ù… Ø¨Û•Ø´Û•ØŒ ØªÚ©Ø§ÛŒÛ• Ø¨Û• Ø¦Û•Ú©Ø§ÙˆÙ†ØªÛŒ Ø¦Û•Ø¯Ù…ÛŒÙ†ÛŒ Ø®Û†Øª Ø¨Ú†Û†Ø±Û• Ú˜ÙˆÙˆØ±Û•ÙˆÛ•.</p>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <button onclick="handleLogin()" class="btn-neon px-8 py-3 rounded-xl font-bold text-lg">Ú†ÙˆÙˆÙ†Û•Ú˜ÙˆÙˆØ±Û•ÙˆÛ•</button>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  </div>
Â  Â  Â  Â  Â  Â  Â  Â  </div>
Â  Â  Â  Â  Â  Â  Â  Â  `;
Â  Â  Â  Â  }

Â  Â  Â  Â  function ScheduleModal() {
Â  Â  Â  Â  Â  Â  // ...
Â  Â  Â  Â  }

Â  Â  Â  Â  function renderReportModal() {
Â  Â  Â  Â  Â  Â  // ...
Â  Â  Â  Â  }

Â  Â  Â  Â  function render() {
Â  Â  Â  Â  Â  Â  document.body.className = document.body.className.replace(/ (dark|admin)-mode/g, '');
Â  Â  Â  Â  Â  Â  if (state.currentView === 'admin') { document.body.classList.add('admin-mode'); }
Â  Â  Â  Â  Â  Â  else if (state.theme === 'dark') { document.body.classList.add('dark-mode'); }
Â  Â  Â  Â  Â  Â  
Â  Â  Â  Â  Â  Â  const appEl = document.getElementById('app');
Â  Â  Â  Â  Â  Â  appEl.innerHTML = Header() + Navigation() + (state.currentView === 'teacher' ? renderTeacherView() : renderAdminView());
Â  Â  Â  Â  Â  Â  if(state.showReportModal) appEl.innerHTML += renderReportModal();
Â  Â  Â  Â  Â  Â  if(state.showSchedule) appEl.innerHTML += ScheduleModal();
Â  Â  Â  Â  Â  Â  calculateScale();
Â  Â  Â  Â  }

Â  Â  Â  Â  // loadActivities(); // Ù„Ø§Ø¯Û•Ø¨Ø±ÛØª Ú†ÙˆÙ†Ú©Û• onAuthStateChanged Ø¨Ø§Ù†Ú¯ÛŒ Ø¯Û•Ú©Ø§Øª
Â  Â  Â  Â  // render(); // Ù„Ø§Ø¯Û•Ø¨Ø±ÛØª Ú†ÙˆÙ†Ú©Û• onAuthStateChanged Ø¨Ø§Ù†Ú¯ÛŒ Ø¯Û•Ú©Ø§Øª

Â  Â  Â  Â  // ... Ø¨Ø§Ù‚ÛŒ ÙØ§Ù†Ú©Ø´Ù†Û•Ú©Ø§Ù† (Ø¨Û† Ø¦Û•ÙˆÛ•ÛŒ Ú©Û†Ø¯Û•Ú©Û• ØªÛ•ÙˆØ§Ùˆ Ø¨ÛØª) ...
Â  Â  Â  Â  
Â  Â  Â  Â  // ÙØ§Ù†Ú©Ø´Ù†ÛŒ ReportModal Ùˆ ScheduleModal
Â  Â  Â  Â  function ScheduleModal() {
Â  Â  Â  Â  Â  Â  if (!state.showSchedule) return '';
Â  Â  Â  Â  Â  Â  const days = ['Ø´Û•Ù…Ù…Û•', 'ÛŒÛ•Ú©Ø´Û•Ù…Ù…Û•', 'Ø¯ÙˆÙˆØ´Û•Ù…Ù…Û•', 'Ø³ÛØ´Û•Ù…Ù…Û•', 'Ú†ÙˆØ§Ø±Ø´Û•Ù…Ù…Û•', 'Ù¾ÛÙ†Ø¬Ø´Û•Ù…Ù…Û•'];
Â  Â  Â  Â  Â  Â  const lessons = ['ÙˆØ§Ù†Û•ÛŒ ÛŒÛ•Ú©Û•Ù…', 'ÙˆØ§Ù†Û•ÛŒ Ø¯ÙˆÙˆÛ•Ù…', 'ÙˆØ§Ù†Û•ÛŒ Ø³ÛÛŒÛ•Ù…', 'ÙˆØ§Ù†Û•ÛŒ Ú†ÙˆØ§Ø±Û•Ù…', 'ÙˆØ§Ù†Û•ÛŒ Ù¾ÛÙ†Ø¬Û•Ù…', 'ÙˆØ§Ù†Û•ÛŒ Ø´Û•Ø´Û•Ù…'];
Â  Â  Â  Â  Â  Â  
Â  Â  Â  Â  Â  Â  const monthlyActivities = state.activities
Â  Â  Â  Â  Â  Â  Â  Â  .filter(a => a.date.startsWith(state.filterDate))
Â  Â  Â  Â  Â  Â  Â  Â  .sort((a, b) => a.date.localeCompare(b.date));

Â  Â  Â  Â  Â  Â  const groupedByDay = monthlyActivities.reduce((acc, activity) => {
Â  Â  Â  Â  Â  Â  Â  Â  const day = activity.dayOfWeek;
Â  Â  Â  Â  Â  Â  Â  Â  if (!acc[day]) acc[day] = {};
Â  Â  Â  Â  Â  Â  Â  Â  const lesson = getLessonName(activity);
Â  Â  Â  Â  Â  Â  Â  Â  if (!acc[day][lesson]) acc[day][lesson] = [];
Â  Â  Â  Â  Â  Â  Â  Â  acc[day][lesson].push(activity);
Â  Â  Â  Â  Â  Â  Â  Â  return acc;
Â  Â  Â  Â  Â  Â  }, {});

Â  Â  Â  Â  Â  Â  return `
Â  Â  Â  Â  Â  Â  Â  Â  <div id="reportModal" class="fixed inset-0 bg-black bg-opacity-80 z-[100] flex items-center justify-center p-4 overflow-y-auto">
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <div class="report-wrapper w-full max-w-full md:max-w-4xl relative">
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <div class="a4-page bg-white p-8 md:p-12 shadow-2xl transition-all duration-300" id="schedulePage">
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <div class="text-center mb-6 border-b pb-4">
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <h2 class="text-2xl font-black text-gray-900 mb-1">Ø®Ø´ØªÛ•ÛŒ Ú†Ø§Ù„Ø§Ú©ÛŒÛ•Ú©Ø§Ù†ÛŒ Ù…Ø§Ù†Ú¯ÛŒ ${state.filterDate}</h2>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <p class="text-sm text-gray-600">Ù‚ÙˆØªØ§Ø¨Ø®Ø§Ù†Û•ÛŒ Ú¯Ø²Ù†Ú¯</p>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  </div>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <table class="report-table">
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <thead>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <tr>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <th class="w-1/12">Ú•Û†Ú˜</th>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  ${lessons.map(l => `<th class="w-1/6">${l.replace('ÙˆØ§Ù†Û•ÛŒ ', '')}</th>`).join('')}
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  </tr>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  </thead>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <tbody>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  ${days.map(day => `
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <tr>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <td class="font-bold bg-gray-50">${day}</td>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  ${lessons.map(lesson => `
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <td>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  ${(groupedByDay[day] && groupedByDay[day][lesson]) ? 
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  groupedByDay[day][lesson].map(a => `<div class="mb-1 text-[10px]"><span class="font-bold">${a.teacherName}</span><br><span>(${a.activityName})</span><br><span class="text-gray-500">${a.date}</span></div>`).join('<hr class="my-1 border-gray-200">') 
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  : ''}
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  </td>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  `).join('')}
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  </tr>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  `).join('')}
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  </tbody>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  </table>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  </div>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <div class="no-print absolute top-4 left-4 flex gap-2">
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <button onclick="downloadElementAsImage('schedulePage', 'Schedule-${state.filterDate}.jpg')" class="btn-neon px-4 py-2 rounded-lg font-bold">Ø¯Ø§Ú¯Ø±ØªÙ† ÙˆÛ•Ú© ÙˆÛÙ†Û•</button>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <button onclick="state.showSchedule = false; render()" class="btn-white px-4 py-2 rounded-lg font-bold">Ø¯Ø§Ø®Ø³ØªÙ†</button>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  </div>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  </div>
Â  Â  Â  Â  Â  Â  Â  Â  </div>`;
Â  Â  Â  Â  }

Â  Â  Â  Â  function renderReportModal() {
Â  Â  Â  Â  Â  Â  return `
Â  Â  Â  Â  Â  Â  Â  Â  <div id="reportModal" class="fixed inset-0 bg-black bg-opacity-80 z-[100] flex items-center justify-center p-4 overflow-y-auto">
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <div class="report-wrapper w-full max-w-full md:max-w-4xl relative">
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <div class="a4-page bg-white p-8 md:p-12 shadow-2xl transition-all duration-300 ${state.report.orientation === 'portrait' ? 'w-[210mm] min-h-[297mm]' : 'w-[297mm] min-h-[210mm]'} ${state.report.orientation === 'landscape' ? 'aspect-[297/210]' : 'aspect-[210/297]'}" id="reportPage">
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <div class="flex justify-between items-start mb-6 border-b pb-4">
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <div class="flex items-center gap-4">
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <img src="${LOGO_URL}" alt="Logo" class="w-16 h-16 object-contain">
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <div>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <h2 class="text-xl font-black text-gray-900">Ú•Ø§Ù¾Û†Ø±ØªÛŒ Ú†Ø§Ù„Ø§Ú©ÛŒ</h2>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <p class="text-sm text-gray-600">Ù‚ÙˆØªØ§Ø¨Ø®Ø§Ù†Û•ÛŒ Ú¯Ø²Ù†Ú¯</p>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  </div>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  </div>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <div class="text-left font-mono">
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <p class="text-sm text-gray-600">Ø¨Û•Ø±ÙˆØ§Ø±: ${state.report.date}</p>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <p class="text-sm text-gray-600">Ù„Ø§Ù¾Û•Ú•Û•: 1</p>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  </div>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  </div>

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <div class="grid grid-cols-2 gap-4 mb-6">
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <div class="col-span-1">
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <label class="text-xs font-bold text-gray-600 block mb-1">Ù†Ø§ÙˆÛŒ Ú†Ø§Ù„Ø§Ú©ÛŒ</label>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <input type="text" value="${state.report.activityName}" class="w-full font-bold text-lg border-b border-gray-300 pb-1 focus:border-blue-500 transition duration-150" oninput="state.report.activityName=this.value; render()" placeholder="Ù†Ø§ÙˆÛŒ Ú†Ø§Ù„Ø§Ú©ÛŒ Ù„ÛØ±Û• Ø¨Ù†ÙˆÙˆØ³Û•...">
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  </div>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <div class="col-span-1">
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <label class="text-xs font-bold text-gray-600 block mb-1">Ù†Ø§ÙˆÛŒ Ù…Ø§Ù…Û†Ø³ØªØ§</label>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <input type="text" value="${state.report.teacherName}" class="w-full font-bold text-lg border-b border-gray-300 pb-1 focus:border-blue-500 transition duration-150" oninput="state.report.teacherName=this.value; render()" placeholder="Ù†Ø§ÙˆÛŒ Ù…Ø§Ù…Û†Ø³ØªØ§ Ù„ÛØ±Û• Ø¨Ù†ÙˆÙˆØ³Û•...">
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  </div>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  </div>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <h3 class="font-bold text-gray-800 text-lg mb-3 border-b pb-1">ÙˆÛÙ†Û• Ùˆ Ø¨Û•ÚµÚ¯Û•Ú©Ø§Ù† (4 ÙˆÛÙ†Û•)</h3>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â Â 
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <div class="grid gap-4 ${state.report.orientation === 'portrait' ? 'grid-cols-2' : 'grid-cols-4'}">
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  ${Array(4).fill().map((_, idx) => `
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <div class="image-slot ${state.report.orientation === 'portrait' ? 'ar-portrait' : 'ar-landscape'}" 
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  onmousedown="startDrag(event, ${idx})" 
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  onmousemove="onMove(event)"
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  ontouchstart="startDrag(event, ${idx})" 
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  ontouchmove="onMove(event)">
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  ${state.report.images[idx] ? `
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <img id="rep-img-${idx}" src="${state.report.images[idx]}" class="absolute w-full h-full object-cover transition-transform duration-100 ease-linear" style="transform: scale(${state.report.imgSettings[idx].zoom}); object-position: ${state.report.imgSettings[idx].x}% ${state.report.imgSettings[idx].y}%;">
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <div class="img-controls">
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <input type="range" min="0.5" max="3" step="0.1" value="${state.report.imgSettings[idx].zoom}" oninput="updateImg(${idx}, 'zoom', this.value)" class="w-full">
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <div class="flex gap-2">
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <button onclick="state.report.images[${idx}] = null; render()" class="btn-white text-xs px-2 py-1 rounded-md">Ù„Ø§Ø¨Ø±Ø¯Ù†</button>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  </div>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  </div>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  ` : `
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <label class="text-gray-500 text-center cursor-pointer p-4 w-full h-full flex items-center justify-center">
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <span>+ ÙˆÛÙ†Û•ÛŒ ${idx + 1}</span>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <input type="file" onchange="handleImage(this, ${idx})" accept="image/*" class="hidden">
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  </label>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  `}
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  </div>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  `).join('')}
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  </div>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <div class="mt-8 border-t pt-4">
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <h3 class="font-bold text-gray-800 text-lg mb-3 border-b pb-1">ØªÛØ¨ÛŒÙ†ÛŒ Ùˆ Ú•ÙˆÙˆÙ†ÙƒØ±Ø¯Ù†Ù‡â€ŒÙˆÙ‡â€ŒÛŒ Ø²ÛŒØ§ØªØ±</h3>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <textarea class="w-full border border-gray-300 p-2 min-h-[50px] focus:border-blue-500 rounded-md transition duration-150 text-sm" placeholder="Ù„ÛØ±Û• ØªÛØ¨ÛŒÙ†ÛŒ Ùˆ Ø³Û•Ø±Ù†Ø¬Û•Ú©Ø§Ù†Øª Ø¨Ù†ÙˆÙˆØ³Û•..."></textarea>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  </div>

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <div class="flex justify-between items-center mt-10 text-sm">
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <p class="font-bold">ÙˆØ§Ú˜Û†ÛŒ Ù„Ø§ÛŒÛ•Ù†ÛŒ Ù¾Û•ÛŒÙˆÛ•Ù†Ø¯ÛŒØ¯Ø§Ø±:</p>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <p class="border-t border-gray-400 pt-1 px-10 text-center text-gray-700">Ø¨Û•Ú•ÛÙˆÛ•Ø¨Û•Ø±ÛŒ Ù‚ÙˆØªØ§Ø¨Ø®Ø§Ù†Û•</p>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  </div>

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  </div>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <div class="no-print absolute top-4 left-4 flex gap-2">
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <button onclick="downloadElementAsImage('reportPage', 'Report-${state.report.activityName.trim()}-${state.report.date}.jpg')" class="btn-neon px-4 py-2 rounded-lg font-bold">Ø¯Ø§Ú¯Ø±ØªÙ† ÙˆÛ•Ú© ÙˆÛÙ†Û•</button>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <button onclick="state.report.orientation = state.report.orientation === 'portrait' ? 'landscape' : 'portrait'; render()" class="btn-white px-4 py-2 rounded-lg font-bold">Ú¯Û†Ú•ÛŒÙ†ÛŒ Ù„Ø§Ù¾Û•Ú•Û• (${state.report.orientation === 'portrait' ? 'Landscape' : 'Portrait'})</button>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <button onclick="state.showReportModal = false; render()" class="btn-white px-4 py-2 rounded-lg font-bold">Ø¯Ø§Ø®Ø³ØªÙ†</button>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  </div>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  </div>
Â  Â  Â  Â  Â  Â  Â  Â  </div>`;
Â  Â  Â  Â  }
Â  Â  </script>
</body>
</html>
