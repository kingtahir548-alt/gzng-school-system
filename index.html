// ⚠️ زانیارییەکانی پێویست: ئەم سێ گۆڕاوە پێش دەستپێکردنی Firebase پێویستن

// 1. زانیاری پڕۆژەی Firebase (کۆدەکەی تۆ)
const firebaseConfig = {
  apiKey: "AIzaSyBSj0nAlAbnaWEUp5z3ujKyttuSCLjio6A",
  authDomain: "gzng-fc080.firebaseapp.com",
  projectId: "gzng-fc080",
  storageBucket: "gzng-fc080.firebasestorage.app",
  messagingSenderId: "1044033765196",
  appId: "1:1044033765196:web:7a80b7f5e94eaffb8ed9e9",
  measurementId: "G-C6PSBZJ0F4"
};

// 2. ئیمەیڵی ئەدمین (ئەوەی مافی سڕینەوەی هەیە)
const ALLOWED_ADMIN_EMAIL = 'tahirtahir0509@gmail.com'; 

// 3. دۆمەینی مامۆستایان (ئەگەر هەموو مامۆستاکان دۆمەینێکیان هەبێت)
// ئەگەر ناتەوێت ئەم تایبەتمەندییە بەکاربهێنیت، دەتوانیت بەتاڵی بکەیتەوە ('')
const TEACHER_DOMAIN = ''; 

// ⚠️ گرنگ: مۆدیوڵەکانی Firebase بۆ HTML
// ئەم ئیمپۆرتانە پێویستن بۆ ئەوەی کۆدەکە کار بکات
import { initializeApp } from "https://www.gstatic.com/firebasejs/11.6.1/firebase-app.js";
import { getAuth, signInAnonymously, onAuthStateChanged } from "https://www.gstatic.com/firebasejs/11.6.1/firebase-auth.js";
import { getFirestore, collection, onSnapshot, doc, addDoc, updateDoc, deleteDoc, query } from "https://www.gstatic.com/firebasejs/11.6.1/firebase-firestore.js";

// دەستپێکردنی Firebase و خزمەتگوزارییە سەرەکییەکان
const app = initializeApp(firebaseConfig);
const db = getFirestore(app); // خزمەتگوزاری Firestore
const auth = getAuth(app);    // خزمەتگوزاری Authentication

let userId = null; // IDی بەکارهێنەری ئێستا

// ----------------------------------------------------------------------
// بەشی Authentication
// ----------------------------------------------------------------------

// دەستپێکردنی چوونەژوورەوەی نەناسراو و دیاریکردنی گۆڕانکارییەکانی بەکارهێنەر
onAuthStateChanged(auth, (user) => {
    if (user) {
        // بەکارهێنەر چوونەژوورەوەی کردووە
        userId = user.uid;
        console.log("بەکارهێنەر چوونەژوورەوەی کردووە. IDی بەکارهێنەر:", userId);

        // لێرەدا دەتوانیت فەنکشنە سەرەکییەکانی وەک بارکردنی چالاکییەکان بانگ بکەیت
        // loadActivities(userId); 

    } else {
        // بەکارهێنەر چوونەژوورەوەی نەکردووە، بە نەناسراوی بچۆرە ژوورەوە
        signInAnonymously(auth)
            .then(() => {
                console.log("چوونەژوورەوەی نەناسراو بە سەرکەوتوویی ئەنجامدرا.");
            })
            .catch((error) => {
                console.error("هەڵە لە چوونەژوورەوەی نەناسراودا:", error);
            });
    }
});

// ----------------------------------------------------------------------
// بەشی نموونەیی بۆ کارکردن لەگەڵ Firestore
// ----------------------------------------------------------------------

/**
 * نموونەیەک بۆ زیادکردنی چالاکییەکی نوێ
 * @param {string} activityText - دەقی چالاکییەکە.
 */
async function addActivity(activityText) {
    if (!userId) {
        console.warn("هێشتا بەکارهێنەر ئامادە نییە بۆ نووسین.");
        return;
    }
    
    try {
        const docRef = await addDoc(collection(db, "activities"), {
            text: activityText,
            timestamp: Date.now(),
            creatorId: userId,
            creatorEmail: auth.currentUser.email || 'Anonymous' 
        });
        console.log("چالاکی زیاد کرا بە ID:", docRef.id);
    } catch (e) {
        console.error("هەڵە لە زیادکردنی چالاکیدا: ", e);
    }
}

/**
 * نموونەیەک بۆ سڕینەوەی چالاکییەک (تەنها بۆ ئەدمین)
 * @param {string} activityId - IDی دۆکیومێنتەکە.
 */
async function deleteActivity(activityId) {
    const currentUserEmail = auth.currentUser?.email;

    if (currentUserEmail !== ALLOWED_ADMIN_EMAIL) {
        console.error("تەنها ئەدمین مافی سڕینەوەی هەیە.");
        return;
    }

    try {
        await deleteDoc(doc(db, "activities", activityId));
        console.log("چالاکیەکە سڕایەوە.");
    } catch (e) {
        console.error("هەڵە لە سڕینەوەدا: ", e);
    }
}


// ⚠️ یاداشت: 
// کاتێک ئەم کۆدە لە فایلی HTML دا دەنێیت، دڵنیابە لەوەی لەناو تاگی
// <script type="module">...</script> دایبنێیت بۆ ئەوەی ئیمپۆرتەکان کار بکەن.
