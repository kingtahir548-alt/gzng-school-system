<!DOCTYPE html>
<html lang="ku" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Ø¨Û•Ø¯ÙˆØ§Ø¯Ø§Ú†ÙˆÙˆÙ†ÛŒ Ú†Ø§Ù„Ø§Ú©ÛŒÛŒÛ•Ú©Ø§Ù†ÛŒ Ù‚ÙˆØªØ§Ø¨Ø®Ø§Ù†Û•</title>
    <!-- Ù„Û†Ø¯Ú©Ø±Ø¯Ù†ÛŒ Tailwind CSS Ø¨Û† Ø¯ÛŒØ²Ø§ÛŒÙ† -->
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Noto+Sans+Arabic:wght@400;700;900&display=swap');
        body {
            font-family: 'Noto Sans Arabic', sans-serif;
            background-color: #eef2ff; /* Ø±Û•Ù†Ú¯ÛŒ Ø´ÛŒÙ†ÛÚ©ÛŒ Ø¦Ø§Ø±Ø§Ù… */
        }
        #app-container {
            max-width: 900px;
            margin: 20px auto;
            padding: 20px;
            background-color: #ffffff;
            border-radius: 16px;
            box-shadow: 0 10px 25px rgba(0, 0, 0, 0.1);
        }
        /* Ø³ØªØ§ÛŒÙ„ÛŒ Ú¯Ø´ØªÛŒ Ú©Ø§Ø±Ø¯ */
        .card {
            background-color: #ffffff;
            border-radius: 12px;
            padding: 20px;
            box-shadow: 0 4px 6px rgba(0, 0, 0, 0.05);
            transition: transform 0.2s, box-shadow 0.2s;
        }
        .card:hover {
            transform: translateY(-2px);
            box-shadow: 0 6px 15px rgba(0, 0, 0, 0.1);
        }

        /* Ø³ØªØ§ÛŒÙ„ Ø¨Û† Ù…Û†Ø¯Ø§Úµ (Confirm Dialog) */
        .modal {
            display: none; position: fixed; z-index: 1000; left: 0; top: 0; width: 100%; height: 100%;
            overflow: auto; background-color: rgba(0,0,0,0.6);
            backdrop-filter: blur(3px); /* Ø¨Û† Ø¯ÛŒØ²Ø§ÛŒÙ†ÛÚ©ÛŒ Ø¬ÙˆØ§Ù†ØªØ± */
        }
        .modal-content {
            background-color: #fefefe; margin: 10% auto; padding: 30px; border-radius: 15px;
            width: 90%; max-width: 450px; text-align: center;
            animation: fadeIn 0.3s ease-out;
        }
        @keyframes fadeIn {
            from { opacity: 0; transform: scale(0.9); }
            to { opacity: 1; transform: scale(1); }
        }
    </style>
</head>
<body>

    <div id="app-container" class="space-y-8">
        
        <!-- Ø¨Û•Ø´ÛŒ Ø³Û•Ø±Û•Ú©ÛŒ Ùˆ Ù¾Ú•Û†ÙØ§ÛŒÙ„ -->
        <header class="bg-indigo-600 text-white p-6 rounded-xl shadow-xl">
            <h1 class="text-4xl font-extrabold mb-2 flex items-center">
                <svg xmlns="http://www.w3.org/2000/svg" class="h-8 w-8 ml-2" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2">
                  <path stroke-linecap="round" stroke-linejoin="round" d="M9 12h6m-6 4h6m2 5H7a2 2 0 01-2-2V5a2 2 0 012-2h5.586a1 1 0 01.707.293l5.414 5.414a1 1 0 01.293.707V19a2 2 0 01-2 2z" />
                </svg>
                Ø¨Û•Ø¯ÙˆØ§Ø¯Ø§Ú†ÙˆÙˆÙ†ÛŒ Ú†Ø§Ù„Ø§Ú©ÛŒÛŒ Ù‚ÙˆØªØ§Ø¨Ø®Ø§Ù†Û•
            </h1>
            <p class="text-indigo-200">Ø³ÛŒØ³ØªÛ•Ù…ÛŒ ØªÛ†Ù…Ø§Ø±Ú©Ø±Ø¯Ù†ÛŒ Ú†Ø§Ù„Ø§Ú©ÛŒÛŒÛ• Ú¯Ø´ØªÛŒÛŒÛ•Ú©Ø§Ù† Ø¨Û• Ú©Ø§ØªÛŒ Ú•Ø§Ø³ØªÛ•Ù‚ÛŒÙ†Û•.</p>
            
            <!-- Ø²Ø§Ù†ÛŒØ§Ø±ÛŒ Ø¨Û•Ú©Ø§Ø±Ù‡ÛÙ†Û•Ø± Ùˆ Ø¦Û•Ø¯Ù…ÛŒÙ† -->
            <div id="user-status-area" class="mt-4 pt-3 border-t border-indigo-500">
                <div id="admin-status" class="text-sm font-extrabold bg-purple-400 text-white p-2 rounded-lg mb-2 flex items-center hidden">
                    <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5 ml-1" viewBox="0 0 20 20" fill="currentColor">
                        <path d="M10 2a5 5 0 00-5 5v2a2 2 0 00-2 2v5a2 2 0 002 2h10a2 2 0 002-2v-5a2 2 0 00-2-2V7a5 5 0 00-5-5zm0 2a3 3 0 003 3v2H7V7a3 3 0 003-3z" clip-rule="evenodd" />
                    </svg>
                    ØªÛ† **Ø¦Û•Ø¯Ù…ÛŒÙ†ÛŒØª**! (Ù…Ø§ÙÛŒ Ø³Ú•ÛŒÙ†Û•ÙˆÛ• Ù‡Û•ÛŒÛ•)
                </div>

                <div class="flex flex-col md:flex-row justify-between items-start md:items-center text-sm">
                    <span class="font-semibold">IDÛŒ Ø¨Û•Ú©Ø§Ø±Ù‡ÛÙ†Û•Ø±: <span id="current-user-id" class="text-yellow-300 font-mono">Ú†Ø§ÙˆÛ•Ú•ÛÛŒ Ú†ÙˆÙˆÙ†Û•Ú˜ÙˆÙˆØ±Û•ÙˆÛ•...</span></span>
                    <div id="auth-buttons" class="space-x-3 flex mt-2 md:mt-0">
                        <button id="google-login-btn" onclick="signInWithGoogle()" class="bg-green-400 text-indigo-900 px-4 py-2 rounded-full font-bold text-sm hover:bg-green-300 transition duration-200 shadow-md">
                            Ú†ÙˆÙˆÙ†Û•Ú˜ÙˆÙˆØ±Û•ÙˆÛ• Ø¨Û• Ú¯ÙˆÙˆÚ¯Úµ
                        </button>
                        <button id="signout-btn" onclick="signOutUser()" class="bg-red-500 text-white px-4 py-2 rounded-full font-bold text-sm hover:bg-red-600 transition duration-200 shadow-md hidden">
                            Ø¯Û•Ø±Ú†ÙˆÙˆÙ†
                        </button>
                    </div>
                </div>
            </div>
        </header>
        
        <!-- Ø³Ù†Ø¯ÙˆÙ‚ÛŒ Ù¾ÛŒØ´Ø§Ù†Ø¯Ø§Ù†ÛŒ Ù‡Û•ÚµÛ• -->
        <div id="error-message" class="bg-red-100 border-r-4 border-red-500 text-red-700 p-4 rounded-lg hidden" role="alert">
            <p class="font-bold">âš ï¸ Ú©ÛØ´Û•ÛŒ Ú†ÙˆÙˆÙ†Û•Ú˜ÙˆÙˆØ±Û•ÙˆÛ• Ú•ÙˆÙˆÛŒØ¯Ø§:</p>
            <p id="error-details">ØªÚ©Ø§ÛŒÛ• Ø¨Ù¾Ø´Ú©Ù†Û• Ú©Û• Ø¯Û†Ù…Û•ÛŒÙ†Û•Ú©Û•Øª Ù„Û• Ú©Û†Ù†Ø³Û†ÚµÛŒ Firebase Ø²ÛŒØ§Ø¯Ú©Ø±Ø§ÙˆÛ•.</p>
        </div>

        <!-- ÙÛ†Ø±Ù…ÛŒ Ø²ÛŒØ§Ø¯Ú©Ø±Ø¯Ù†ÛŒ Ú†Ø§Ù„Ø§Ú©ÛŒ -->
        <div id="add-activity-section" class="card hidden">
            <h2 class="text-xl font-bold mb-4 text-gray-700 border-b pb-2">â• ØªÛ†Ù…Ø§Ø±Ú©Ø±Ø¯Ù†ÛŒ Ú†Ø§Ù„Ø§Ú©ÛŒ Ù†ÙˆÛ</h2>
            <div class="flex flex-col space-y-3 md:flex-row md:space-y-0 md:space-x-4">
                <input type="text" id="activity-input" placeholder="Ù†Ø§ÙˆÙ†ÛŒØ´Ø§Ù†ÛŒ Ú†Ø§Ù„Ø§Ú©ÛŒÛŒÛ•Ú©Û• Ø¨Ù†ÙˆÙˆØ³Û• (Ø¨Û† Ù†Ù…ÙˆÙˆÙ†Û•: Ú©Ø±Ø¯Ù†Û•ÙˆÛ•ÛŒ Ù¾ÛØ´Ø§Ù†Ú¯Ø§ÛŒ Ù‡ÙˆÙ†Û•Ø±ÛŒ)" 
                       class="flex-grow p-3 border border-gray-300 rounded-lg focus:ring-indigo-500 focus:border-indigo-500 text-right">
                <button onclick="handleActivitySubmission()"
                        class="bg-indigo-600 text-white p-3 rounded-lg font-bold hover:bg-indigo-700 transition duration-200 shadow-lg">
                    ØªÛ†Ù…Ø§Ø±Ú©Ø±Ø¯Ù†
                </button>
            </div>
        </div>
        
        <!-- Ù¾Û•ÛŒØ§Ù…ÛŒ Ø¯Ø§ÙˆØ§ÛŒ Ú†ÙˆÙˆÙ†Û•Ú˜ÙˆÙˆØ±Û•ÙˆÛ• -->
        <div id="login-message" class="bg-yellow-100 border-r-4 border-yellow-500 text-yellow-700 p-4 rounded-lg hidden" role="alert">
            <p class="font-bold">Ø³ÚµØ§Ùˆ ğŸ‘‹</p>
            <p>Ø¨Û† Ø²ÛŒØ§Ø¯Ú©Ø±Ø¯Ù†ÛŒ Ú†Ø§Ù„Ø§Ú©ÛŒ Ù†ÙˆÛØŒ ØªÚ©Ø§ÛŒÛ• Ø¨Û• Ø¦Û•Ú©Ø§ÙˆÙ†ØªÛŒ Ú¯ÙˆÙˆÚ¯Úµ Ø¨Ú†Û†Ø±Û• Ú˜ÙˆÙˆØ±Û•ÙˆÛ•.</p>
        </div>

        <!-- Ù„ÛŒØ³ØªÛŒ Ú†Ø§Ù„Ø§Ú©ÛŒÛŒÛ•Ú©Ø§Ù† -->
        <div class="mt-8">
            <h2 class="text-2xl font-bold mb-4 text-gray-800 border-b pb-2">ğŸ“‹ Ù„ÛŒØ³ØªÛŒ Ú¯Ø´ØªÛŒ Ú†Ø§Ù„Ø§Ú©ÛŒÛŒÛ•Ú©Ø§Ù†</h2>
            <div id="activities-list" class="space-y-4">
                <!-- Ú†Ø§Ù„Ø§Ú©ÛŒÛŒÛ•Ú©Ø§Ù† Ù„ÛØ±Û• Ø¨Û• Ú©Û†Ø¯ÛŒ JavaScript Ø¨Ø§Ø± Ø¯Û•Ú©Ø±ÛÙ† -->
                <p class="text-gray-500 p-4 bg-gray-50 rounded-lg shadow-inner">Ú†Ø§ÙˆÛ•Ú•ÛÛŒ Ø¨Ø§Ø±Ú©Ø±Ø¯Ù†ÛŒ Ú†Ø§Ù„Ø§Ú©ÛŒÛŒÛ•Ú©Ø§Ù†...</p>
            </div>
        </div>

    </div>

    <!-- Ù…Û†Ø¯Ø§Úµ Ø¨Û† Ù¾Ø´ØªÚ•Ø§Ø³ØªÚ©Ø±Ø¯Ù†Û•ÙˆÛ•ÛŒ Ø³Ú•ÛŒÙ†Û•ÙˆÛ• -->
    <div id="deleteModal" class="modal">
        <div class="modal-content">
            <p class="text-xl font-bold mb-4 text-red-600">âš  Ø¯ÚµÙ†ÛŒØ§ÛŒ Ù„Û• Ø³Ú•ÛŒÙ†Û•ÙˆÛ•ØŸ</p>
            <p class="mb-8 text-gray-700">Ø¦Û•Ù… Ú©Ø±Ø¯Ø§Ø±Û• Ù‡Û•ÚµÙ†Ø§Ú¯ÛŒØ±ÛØªÛ•ÙˆÛ• Ùˆ Ú†Ø§Ù„Ø§Ú©ÛŒÛŒÛ•Ú©Û• Ø¨Û• ÛŒÛ•Ú©Ø¬Ø§Ø±ÛŒ Ø¯Û•Ø³Ú•Ø¯Ø±ÛØªÛ•ÙˆÛ•.</p>
            <div class="flex justify-center space-x-4">
                <button onclick="confirmDelete(true)" class="px-6 py-3 bg-red-600 text-white rounded-full font-bold hover:bg-red-700 transition duration-200 shadow-lg">
                    Ø¨Û•ÚµÛØŒ Ø¨ÛŒØ³Ú•Û•ÙˆÛ•
                </button>
                <button onclick="confirmDelete(false)" class="px-6 py-3 bg-gray-300 text-gray-800 rounded-full font-bold hover:bg-gray-400 transition duration-200">
                    Ù†Û•Ø®ÛØ±ØŒ Ù‡Û•ÚµÚ¯Ø±ØªÙ†
                </button>
            </div>
        </div>
    </div>

    <!-- âš ï¸ Ø¨Û•Ø´ÛŒ Ù…Û†Ø¯ÛŒÙˆÚµÛŒ JavaScript Ùˆ Firebase -->
    <script type="module">
        
        // âš ï¸ Ú¯Û†Ú•Ø§ÙˆÛ• Ú¯Ø´ØªÛŒÛŒÛ•Ú©Ø§Ù† Ø¨Û† Ù¾Ø±Û†Ú˜Û•Ú©Û•ÛŒ ØªÛ† (Ø²Ø§Ù†ÛŒØ§Ø±ÛŒÛŒÛ•Ú©Ø§Ù† Ù„Û• ÙˆÛ•ÚµØ§Ù…ÛŒ Ù¾ÛØ´ÙˆÙˆÛ•ÙˆÛ• ÙˆÛ•Ø±Ú¯ÛŒØ±Ø§ÙˆÙ†)
        const firebaseConfig = {
          apiKey: "AIzaSyBSj0nAlAbnaWEUp5z3ujKyttuSCLjio6A",
          authDomain: "gzng-fc080.firebaseapp.com",
          projectId: "gzng-fc080",
          storageBucket: "gzng-fc080.firebasestorage.app",
          messagingSenderId: "1044033765196",
          appId: "1:1044033765196:web:7a80b7f5e94eaffb8ed9e9",
          measurementId: "G-C6PSBZJ0F4"
        };

        // âš ï¸ Ø¦Û•Ù…Û• Ø¦ÛŒÙ…Û•ÛŒÚµÛŒ Ø¦Û•Ø¯Ù…ÛŒÙ†Û• Ú©Û• Ù…Ø§ÙÛŒ Ø³Ú•ÛŒÙ†Û•ÙˆÛ•ÛŒ Ú†Ø§Ù„Ø§Ú©ÛŒÛŒÛ•Ú©Ø§Ù†ÛŒ Ù‡Û•ÛŒÛ•.
        // **Ø¦Û•Ù…Û• Ú©Ù„ÛŒÙ„Û•Ú©Û•ÛŒÛ• Ø¨Û† Ú†Ø§ÚµØ§Ú©Ú©Ø±Ø¯Ù†ÛŒ Ø¨Û•Ø´ÛŒ Ø¦Û•Ø¯Ù…ÛŒÙ† Ø¨Û† ØªÛ†**
        const ALLOWED_ADMIN_EMAIL = 'tahirtahir0509@gmail.com'; 

        // âš ï¸ Ù…Û†Ø¯ÛŒÙˆÚµÛ•Ú©Ø§Ù†ÛŒ Firebase
        import { initializeApp } from "https://www.gstatic.com/firebasejs/11.6.1/firebase-app.js";
        import { getAuth, signInAnonymously, onAuthStateChanged, GoogleAuthProvider, signInWithPopup, signOut } from "https://www.gstatic.com/firebasejs/11.6.1/firebase-auth.js";
        import { getFirestore, collection, onSnapshot, doc, addDoc, deleteDoc, query } from "https://www.gstatic.com/firebasejs/11.6.1/firebase-firestore.js";

        // Ø¯Û•Ø³ØªÙ¾ÛÚ©Ø±Ø¯Ù†ÛŒ Firebase
        const app = initializeApp(firebaseConfig);
        const db = getFirestore(app); 
        const auth = getAuth(app);    
        const googleProvider = new GoogleAuthProvider(); 
        
        let userId = null; 
        let pendingDeleteId = null; 

        // ----------------------------------------------------------------------
        // Ø¨Û•Ø´ÛŒ UI (Ú•ÙˆÙˆÚ©Ø§Ø±ÛŒ Ø¨Û•Ú©Ø§Ø±Ù‡ÛÙ†Û•Ø±)
        // ----------------------------------------------------------------------

        function displayError(message) {
            const errorBox = document.getElementById('error-message');
            const errorDetails = document.getElementById('error-details');
            errorDetails.textContent = message;
            errorBox.classList.remove('hidden');
        }

        function hideError() {
            document.getElementById('error-message').classList.add('hidden');
        }

        /**
         * Ù†ÙˆÛÚ©Ø±Ø¯Ù†Û•ÙˆÛ•ÛŒ UI Ø¨Û•Ù¾ÛÛŒ Ø³ØªØ§ØªÙˆØ³ÛŒ Ø¨Û•Ú©Ø§Ø±Ù‡ÛÙ†Û•Ø± (Ø¦Û•Ø¯Ù…ÛŒÙ†/Ø¦Ø§Ø³Ø§ÛŒÛŒ/Ø¯Û•Ø±Ú†ÙˆÙˆ)
         */
        function updateUIForUser(user) {
            const userIdElement = document.getElementById('current-user-id');
            const loginBtn = document.getElementById('google-login-btn');
            const signoutBtn = document.getElementById('signout-btn');
            const addSection = document.getElementById('add-activity-section');
            const loginMsg = document.getElementById('login-message');
            const adminStatus = document.getElementById('admin-status');

            if (user && !user.isAnonymous) {
                // Ø¨Û•Ú©Ø§Ø±Ù‡ÛÙ†Û•Ø± Ø¨Û• Ú¯ÙˆÙˆÚ¯Úµ Ú†Û†ØªÛ• Ú˜ÙˆÙˆØ±Û•ÙˆÛ• (Ø¨Û•Ú©Ø§Ø±Ù‡ÛÙ†Û•Ø±ÛŒ ØªÛ†Ù…Ø§Ø±Ú©Ø±Ø§Ùˆ)
                userIdElement.textContent = `${user.email} (ID: ${user.uid.substring(0, 8)}...)`;
                loginBtn.classList.add('hidden');
                signoutBtn.classList.remove('hidden');
                addSection.classList.remove('hidden');
                loginMsg.classList.add('hidden');
                hideError(); 

                // **Ú†Ø§ÚµØ§Ú©Ú©Ø±Ø¯Ù†ÛŒ Ø¨Û•Ø´ÛŒ Ø¦Û•Ø¯Ù…ÛŒÙ† Ù„ÛØ±Û•Ø¯Ø§ÛŒÛ•**
                if (user.email === ALLOWED_ADMIN_EMAIL) {
                    adminStatus.classList.remove('hidden');
                } else {
                    adminStatus.classList.add('hidden');
                }

            } else {
                // Ø¨Û•Ú©Ø§Ø±Ù‡ÛÙ†Û•Ø± Ù†Û•Ù†Ø§Ø³Ø±Ø§ÙˆÛ• ÛŒØ§Ù† Ø¯Û•Ø±Ú†ÙˆÙˆÛ•
                userIdElement.textContent = `Ú†ÙˆÙˆÙ†Û•Ú˜ÙˆÙˆØ±Û•ÙˆÛ• Ù†Û•Ú©Ø±Ø§ÙˆÛ•`;
                loginBtn.classList.remove('hidden');
                signoutBtn.classList.add('hidden');
                addSection.classList.add('hidden');
                loginMsg.classList.remove('hidden');
                adminStatus.classList.add('hidden');
            }
        }

        // ----------------------------------------------------------------------
        // Ø¨Û•Ø´ÛŒ Firestore Data Load & Render
        // ----------------------------------------------------------------------

        /**
         * Ù†Ù…Ø§ÛŒØ´Ú©Ø±Ø¯Ù†ÛŒ Ú†Ø§Ù„Ø§Ú©ÛŒÛŒÛ•Ú©Ø§Ù† Ù„Û•Ù†Ø§Ùˆ Ù„ÛŒØ³ØªÛ•Ú©Û•Ø¯Ø§.
         */
        function renderActivities(activities) {
            const listElement = document.getElementById('activities-list');
            if (!listElement) return;

            listElement.innerHTML = ''; 

            if (activities.length === 0) {
                listElement.innerHTML = `<p class="text-gray-600 p-4 bg-indigo-50 border-r-4 border-indigo-300 rounded-lg shadow-inner">Ù‡ÛŒÚ† Ú†Ø§Ù„Ø§Ú©ÛŒÛŒÛ•Ú© ØªÛ†Ù…Ø§Ø± Ù†Û•Ú©Ø±Ø§ÙˆÛ•. ÛŒÛ•Ú©Û•Ù… Ú†Ø§Ù„Ø§Ú©ÛŒ Ø²ÛŒØ§Ø¯ Ø¨Ú©Û•!</p>`;
                return;
            }
            
            // Ú©Ù„ÛŒÙ„Û•Ú©Û• Ù„ÛØ±Û•Ø¯Ø§ÛŒÛ•: ØªÛ•Ù†Ù‡Ø§ Ø¦Û•Ø¯Ù…ÛŒÙ† Ø¯ÙˆÚ¯Ù…Û•ÛŒ Ø³Ú•ÛŒÙ†Û•ÙˆÛ• Ø¯Û•Ø¨ÛŒÙ†ÛØª
            const isUserAdmin = auth.currentUser?.email === ALLOWED_ADMIN_EMAIL;
            const isLoggedIn = auth.currentUser && !auth.currentUser.isAnonymous;

            activities.forEach(activity => {
                const activityId = activity.id;
                
                const activityCard = document.createElement('div');
                activityCard.className = 'card flex justify-between items-center bg-white p-4';
                
                const infoDiv = document.createElement('div');
                const activityDate = new Date(activity.timestamp).toLocaleDateString('ku-IQ', {
                    year: 'numeric', month: 'short', day: 'numeric', hour: '2-digit', minute: '2-digit'
                });
                
                // Ø¨Û•Ø´ÛŒ Ø¯Û•Ù‚
                infoDiv.innerHTML = `
                    <p class="text-gray-900 text-lg font-bold">${activity.text}</p>
                    <p class="text-sm text-gray-500 mt-1">
                        Ù„Û•Ù„Ø§ÛŒÛ•Ù†: <span class="font-medium text-indigo-600">${activity.creatorEmail || 'Ø¨Û•Ú©Ø§Ø±Ù‡ÛÙ†Û•Ø±' + activity.creatorId.substring(0, 4)}</span>
                        - Ú©Ø§Øª: ${activityDate}
                    </p>
                `;
                activityCard.appendChild(infoDiv);

                // Ø²ÛŒØ§Ø¯Ú©Ø±Ø¯Ù†ÛŒ Ø¯ÙˆÚ¯Ù…Û•ÛŒ Ø³Ú•ÛŒÙ†Û•ÙˆÛ• Ø¦Û•Ú¯Û•Ø± Ø¦Û•Ø¯Ù…ÛŒÙ† Ø¨ÛØª
                if (isUserAdmin && isLoggedIn) {
                    const deleteButton = document.createElement('button');
                    deleteButton.innerHTML = `
                        <svg xmlns="http://www.w3.org/2000/svg" class="h-6 w-6" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2">
                            <path stroke-linecap="round" stroke-linejoin="round" d="M19 7l-.867 12.142A2 2 0 0116.138 21H7.862a2 2 0 01-1.995-1.858L5 7m5 4v6m4-6v6m1-10V4a1 1 0 00-1-1h-4a1 1 0 00-1 1v3M4 7h16" />
                        </svg>
                    `;
                    deleteButton.className = 'ml-4 p-2 bg-red-100 text-red-600 rounded-full hover:bg-red-200 transition duration-150 shadow-md';
                    deleteButton.title = "Ø³Ú•ÛŒÙ†Û•ÙˆÛ•ÛŒ Ú†Ø§Ù„Ø§Ú©ÛŒ (ØªÛ•Ù†Ù‡Ø§ Ø¦Û•Ø¯Ù…ÛŒÙ†)";
                    deleteButton.onclick = () => showDeleteModal(activityId);
                    activityCard.appendChild(deleteButton);
                }
                
                listElement.appendChild(activityCard);
            });
        }
        
        /**
         * Ø¨Ø§Ø±Ú©Ø±Ø¯Ù†ÛŒ Ú†Ø§Ù„Ø§Ú©ÛŒÛŒÛ•Ú©Ø§Ù† Ø¨Û• Ø´ÛÙˆÛ•ÛŒ Ú•Ø§Ø³ØªÛ•ÙˆØ®Û† (onSnapshot)
         */
        function loadActivities() {
            const activitiesCollection = collection(db, "activities");
            
            // Ø¯Ø§Ù†Ø§Ù†ÛŒ Ú¯ÙˆÛÚ¯Ø±ØªÙ†ÛÚ©ÛŒ Ú•Ø§Ø³ØªÛ•ÙˆØ®Û†
            onSnapshot(activitiesCollection, (snapshot) => {
                const activities = [];
                snapshot.forEach((doc) => {
                    activities.push({ id: doc.id, ...doc.data() });
                });
                
                activities.sort((a, b) => b.timestamp - a.timestamp); 
                
                renderActivities(activities);
            }, (error) => {
                console.error("Ù‡Û•ÚµÛ• Ù„Û• Ø¨Ø§Ø±Ú©Ø±Ø¯Ù†ÛŒ Ú†Ø§Ù„Ø§Ú©ÛŒÛŒÛ•Ú©Ø§Ù†: ", error);
                document.getElementById('activities-list').innerHTML = `<p class="text-red-500 p-4 bg-red-100 rounded-lg">Ù‡Û•ÚµÛ• Ù„Û• Ø¨Ø§Ø±Ú©Ø±Ø¯Ù†ÛŒ Ú†Ø§Ù„Ø§Ú©ÛŒÛŒÛ•Ú©Ø§Ù†: ${error.message}</p>`;
            });
        }

        // ----------------------------------------------------------------------
        // Ø¨Û•Ø´ÛŒ Authentication
        // ----------------------------------------------------------------------

        /**
         * Ú†ÙˆÙˆÙ†Û•Ú˜ÙˆÙˆØ±Û•ÙˆÛ• Ø¨Û• Ú¯ÙˆÙˆÚ¯Úµ
         */
        window.signInWithGoogle = async function() {
            hideError();
            try {
                // Ù¾ÛØ´ Ú†ÙˆÙˆÙ†Û•Ú˜ÙˆÙˆØ±Û•ÙˆÛ•ÛŒ Ù†ÙˆÛØŒ Ø¯Û•Ø±Ú†ÙˆÙˆÙ† Ù„Û• Ø¦Û•Ù†Û†Ù†ÛŒÙ…Û•Ø³
                if (auth.currentUser && auth.currentUser.isAnonymous) {
                    await signOut(auth);
                }
                await signInWithPopup(auth, googleProvider);
                console.log("Ú†ÙˆÙˆÙ†Û•Ú˜ÙˆÙˆØ±Û•ÙˆÛ• Ø¨Û• Ú¯ÙˆÙˆÚ¯Úµ Ø¨Û• Ø³Û•Ø±Ú©Û•ÙˆØªÙˆÙˆÛŒÛŒ Ø¦Û•Ù†Ø¬Ø§Ù…Ø¯Ø±Ø§.");
            } catch (error) {
                if (error.code === 'auth/unauthorized-domain') {
                    displayError(`Ù‡Û•ÚµÛ•: Firebase: Error (auth/unauthorized-domain). Ø¦Û•Ù… Ú©ÛØ´Û•ÛŒÛ• Ø²Û†Ø± Ú•ÙˆÙˆ Ø¯Û•Ø¯Ø§Øª Ù„Û• Ú˜ÛŒÙ†Ú¯Û•ÛŒ Canvas/iFrame. Ú†Ø§Ø±Û•Ø³Û•Ø±: ØªÚ©Ø§ÛŒÛ• Ø¯Û†Ù…Û•ÛŒÙ†ÛŒ Ø¦ÛØ³ØªØ§ (ÙˆÛ•Ú© 'localhost') Ù„Û• Ø¨Û•Ø´ÛŒ **Firebase Console** > **Authentication** > **Settings** > **Authorized Domains** Ø²ÛŒØ§Ø¯ Ø¨Ú©Û•.`);
                } else if (error.code === 'auth/popup-closed-by-user') {
                    displayError(`Ú©Ø±Ø¯Ø§Ø±Û•Ú©Û• Ù‡Û•ÚµÙˆÛ•Ø´ÛÙ†Ø±Ø§ÛŒÛ•ÙˆÛ•. Ù¾Û•Ù†Ø¬Û•Ø±Û•ÛŒ Ú†ÙˆÙˆÙ†Û•Ú˜ÙˆÙˆØ±Û•ÙˆÛ•ÛŒ Ú¯ÙˆÙˆÚ¯Úµ Ø¯Ø§Ø®Ø±Ø§Ù†.`);
                } else {
                    displayError(`Ù‡Û•ÚµÛ• Ù„Û• Ú†ÙˆÙˆÙ†Û•Ú˜ÙˆÙˆØ±Û•ÙˆØ¯Ø§: ${error.message}`);
                }
                console.error("Ù‡Û•ÚµÛ• Ù„Û• Ú†ÙˆÙˆÙ†Û•Ú˜ÙˆÙˆØ±Û•ÙˆÛ• Ø¨Û• Ú¯ÙˆÙˆÚ¯Úµ:", error);
            }
        }
        
        /**
         * Ø¯Û•Ø±Ú†ÙˆÙˆÙ† Ù„Û• Ø¦Û•Ú©Ø§ÙˆÙ†Øª Ùˆ Ú†ÙˆÙˆÙ†Û•Ú˜ÙˆÙˆØ±Û•ÙˆÛ• Ø¨Û• Ø´ÛÙˆÛ•ÛŒ Ù†Û•Ù†Ø§Ø³Ø±Ø§Ùˆ
         */
        window.signOutUser = async function() {
            try {
                await signOut(auth);
                console.log("Ø¯Û•Ø±Ú†ÙˆÙˆÙ† Ø¨Û• Ø³Û•Ø±Ú©Û•ÙˆØªÙˆÙˆÛŒÛŒ Ø¦Û•Ù†Ø¬Ø§Ù…Ø¯Ø±Ø§.");
                // Ø¯ÙˆØ§ÛŒ Ø¯Û•Ø±Ú†ÙˆÙˆÙ†ØŒ Ø¯Û•Ø¨ÛØª ÙˆÛ•Ú© Ù†Û•Ù†Ø§Ø³Ø±Ø§Ùˆ Ø¨Ú†ÛŒÙ†Û•ÙˆÛ• Ú˜ÙˆÙˆØ±Û•ÙˆÛ•
                await signInAnonymously(auth);
            } catch (error) {
                console.error("Ù‡Û•ÚµÛ• Ù„Û• Ø¯Û•Ø±Ú†ÙˆÙˆÙ†Ø¯Ø§:", error.message);
                displayError(`Ù‡Û•ÚµÛ• Ù„Û• Ø¯Û•Ø±Ú†ÙˆÙˆÙ†Ø¯Ø§: ${error.message}`);
            }
        }

        // Ø¯Ø§Ù†Ø§Ù†ÛŒ Ú¯ÙˆÛÚ¯Ø±ØªÙ†ÛŒ Ú¯Û†Ú•Ø§Ù†Ú©Ø§Ø±ÛŒÛŒÛ•Ú©Ø§Ù†ÛŒ Ø¨Û•Ú©Ø§Ø±Ù‡ÛÙ†Û•Ø± (Ø¦Û•Ù…Û• Ø¯Û•Ø³ØªÙ¾ÛÚ©ÛŒ Ù¾Ú•Û†Ú˜Û•Ú©Û•ÛŒÛ•)
        onAuthStateChanged(auth, (user) => {
            if (user) {
                userId = user.uid;
                updateUIForUser(user);
                loadActivities(); 
            } else {
                // Ú†ÙˆÙˆÙ†Û•Ú˜ÙˆÙˆØ±Û•ÙˆÛ•ÛŒ Ø³Û•Ø±Û•ØªØ§ÛŒÛŒ ÙˆÛ•Ú© Ù†Û•Ù†Ø§Ø³Ø±Ø§Ùˆ Ø¨Û† Ø®ÙˆÛÙ†Ø¯Ù†Û•ÙˆÛ•ÛŒ Ú¯Ø´ØªÛŒ
                signInAnonymously(auth)
                    .then((credential) => {
                        userId = credential.user.uid;
                        updateUIForUser(null);
                        loadActivities(); 
                    })
                    .catch((error) => {
                        console.error("Ù‡Û•ÚµÛ• Ù„Û• Ú†ÙˆÙˆÙ†Û•Ú˜ÙˆÙˆØ±Û•ÙˆÛ•ÛŒ Ù†Û•Ù†Ø§Ø³Ø±Ø§ÙˆØ¯Ø§:", error);
                        displayError("Ù†Ø§ØªÙˆØ§Ù†Ø±ÛØª Ø¨Ú†ÛØªÛ• Ú˜ÙˆÙˆØ±Û•ÙˆÛ• Ø¨Û† Ø®ÙˆÛÙ†Ø¯Ù†Û•ÙˆÛ•ÛŒ Ú†Ø§Ù„Ø§Ú©ÛŒÛŒÛ•Ú©Ø§Ù†.");
                        updateUIForUser(null);
                    });
            }
        });

        // ----------------------------------------------------------------------
        // Ø¨Û•Ø´ÛŒ Firestore Actions & Modal
        // ----------------------------------------------------------------------

        /**
         * Ú©Û†Ù†ØªØ±Û†ÚµÚ©Ø±Ø¯Ù†ÛŒ Ù†Ø§Ø±Ø¯Ù†ÛŒ ÙÛ†Ø±Ù…ÛŒ Ú†Ø§Ù„Ø§Ú©ÛŒ
         */
        window.handleActivitySubmission = function() {
            const inputElement = document.getElementById('activity-input');
            const activityText = inputElement.value.trim();

            if (activityText.length > 0) {
                addActivity(activityText)
                    .then(() => {
                        inputElement.value = ''; // Ù¾Ø§Ú©Ú©Ø±Ø¯Ù†Û•ÙˆÛ•ÛŒ Ø®Ø§Ù†Û•Ú©Û•
                    });
            } else {
                displayError("ØªÚ©Ø§ÛŒÛ• Ø¯Û•Ù‚ Ø¨Û† Ú†Ø§Ù„Ø§Ú©ÛŒÛŒÛ•Ú©Û• Ø¨Ù†ÙˆÙˆØ³Û•.");
            }
        }
        
        /**
         * Ø²ÛŒØ§Ø¯Ú©Ø±Ø¯Ù†ÛŒ Ú†Ø§Ù„Ø§Ú©ÛŒÛŒÛ•Ú©ÛŒ Ù†ÙˆÛ Ø¨Û† Ø¯Ø§ØªØ§Ø¨Û•ÛŒØ³
         */
        async function addActivity(activityText) {
            if (!userId || auth.currentUser.isAnonymous) {
                displayError("ØªÚ©Ø§ÛŒÛ• Ø³Û•Ø±Û•ØªØ§ Ø¨Û• Ø¦Û•Ú©Ø§ÙˆÙ†ØªÛŒ Ú¯ÙˆÙˆÚ¯Úµ Ø¨Ú†Û†Ø±Û• Ú˜ÙˆÙˆØ±Û•ÙˆÛ• Ø¨Û† Ø²ÛŒØ§Ø¯Ú©Ø±Ø¯Ù†ÛŒ Ú†Ø§Ù„Ø§Ú©ÛŒ.");
                return;
            }
            
            try {
                // Ø²ÛŒØ§Ø¯Ú©Ø±Ø¯Ù†ÛŒ Ø¯Û†Ú©ÛŒÙˆÙ…ÛÙ†ØªÛ•Ú©Û•
                const docRef = await addDoc(collection(db, "activities"), {
                    text: activityText,
                    timestamp: Date.now(),
                    creatorId: userId,
                    creatorEmail: auth.currentUser?.email 
                });
                console.log("Ú†Ø§Ù„Ø§Ú©ÛŒ Ø²ÛŒØ§Ø¯ Ú©Ø±Ø§ Ø¨Û• ID:", docRef.id);
            } catch (e) {
                console.error("Ù‡Û•ÚµÛ• Ù„Û• Ø²ÛŒØ§Ø¯Ú©Ø±Ø¯Ù†ÛŒ Ú†Ø§Ù„Ø§Ú©ÛŒØ¯Ø§: ", e);
                displayError("Ù‡Û•ÚµÛ• Ù„Û• Ø²ÛŒØ§Ø¯Ú©Ø±Ø¯Ù†ÛŒ Ú†Ø§Ù„Ø§Ú©ÛŒØ¯Ø§. Ú•Û•Ù†Ú¯Û• ÛŒØ§Ø³Ø§Ú©Ø§Ù†ÛŒ Ù†ÙˆÙˆØ³ÛŒÙ† Ú©ÛØ´Û•ÛŒØ§Ù† Ù‡Û•Ø¨ÛØª.");
            }
        }

        /**
         * Ù†ÛŒØ´Ø§Ù†Ø¯Ø§Ù†ÛŒ Ø¯ÛŒØ§Ù„Û†Ú¯ÛŒ Ù…Û†Ø¯Ø§Úµ Ø¨Û† Ø³Ú•ÛŒÙ†Û•ÙˆÛ•
         */
        function showDeleteModal(activityId) {
            const currentUserEmail = auth.currentUser?.email;

            if (currentUserEmail !== ALLOWED_ADMIN_EMAIL) {
                displayError("ØªÛ•Ù†Ù‡Ø§ Ø¦Û•Ø¯Ù…ÛŒÙ† Ù…Ø§ÙÛŒ Ø³Ú•ÛŒÙ†Û•ÙˆÛ•ÛŒ Ù‡Û•ÛŒÛ•.");
                return;
            }
            
            pendingDeleteId = activityId;
            document.getElementById('deleteModal').style.display = 'block';
        }
        
        /**
         * Ú©Û†Ù†ØªØ±Û†ÚµÚ©Ø±Ø¯Ù†ÛŒ Ø¯ÛŒØ§Ù„Û†Ú¯ÛŒ Ù…Û†Ø¯Ø§Úµ Ùˆ Ø³Ú•ÛŒÙ†Û•ÙˆÛ•ÛŒ Ú†Ø§Ù„Ø§Ú©ÛŒ
         */
        window.confirmDelete = async function(isConfirmed) {
            document.getElementById('deleteModal').style.display = 'none';

            if (isConfirmed && pendingDeleteId) {
                try {
                    await deleteDoc(doc(db, "activities", pendingDeleteId));
                    console.log("Ú†Ø§Ù„Ø§Ú©ÛŒÛ•Ú©Û• Ø³Ú•Ø§ÛŒÛ•ÙˆÛ•.");
                } catch (e) {
                    console.error("Ù‡Û•ÚµÛ• Ù„Û• Ø³Ú•ÛŒÙ†Û•ÙˆÛ•Ø¯Ø§: ", e);
                    displayError("Ù‡Û•ÚµÛ• Ù„Û• Ø³Ú•ÛŒÙ†Û•ÙˆÛ•Ø¯Ø§. Ú•Û•Ù†Ú¯Û• Ù…Ø§ÙÛŒ Ù¾ÛÙˆÛŒØ³ØªØª Ù†Û•Ø¨ÛØª.");
                }
            }
            pendingDeleteId = null;
        }

    </script>
</body>
</html>
